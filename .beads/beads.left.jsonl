{"id":"crystalmath-02y","content_hash":"6b11d57ff879d9eae8cdfd219a0292bca4c45e7ed5fe598ba4794415562b1c8c","title":"Queue manager N+1 query problem","description":"queue_manager.py:529-558 scans _jobs dict every tick and calls db.get_job() per entry, creating O(n) queries each second as queue grows.\n\nFix:\n- Cache job status in memory (update on status changes)\n- Fetch all job statuses in single query per cycle\n- Use database triggers/views for status aggregation\n- Add query batching with asyncio.gather\n- Implement incremental status polling\n\nImpact: Unnecessary database load as queue grows, latency spikes on large queues.\n\nOptimization:\n# Instead of: for job in _jobs: status = db.get_job(job.id)\n# Use: statuses = db.get_job_statuses([job.id for job in _jobs])\n\nFiles: tui/src/core/queue_manager.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:20.593681-06:00","updated_at":"2025-11-21T12:14:20.593681-06:00","source_repo":".","labels":["database","performance","phase-2","queue"]}
{"id":"crystalmath-0gy","content_hash":"be54fd066f957efa5ccc483af0222a7f97f60fb1f60b0690f01f45da0c2f335c","title":"SECURITY: Escape remote commands in SSH Runner","description":"ssh_runner.py:121-183,358-434 interpolates remote commands without shell escaping. Crafted work_dir or scratch_dir names can inject commands.\n\nFix:\n- Use shlex.quote() for all remote path interpolation\n- Validate directory/file names (no special chars)\n- Quote all paths in execution scripts\n- Use parameterized commands where possible\n- Add command injection tests\n\nExamples of vulnerable code:\n- mkdir -p {remote_scratch_dir}\n- cd {work_dir} \u0026\u0026 run...\n- kill -TERM {pid}\n\nImpact: Command injection on remote systems.\n\nFiles: tui/src/runners/ssh_runner.py","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:46.6857-06:00","updated_at":"2025-11-21T08:07:46.6857-06:00","source_repo":".","labels":["critical","phase-2","remote-execution","security"]}
{"id":"crystalmath-168","content_hash":"a62f27b774f282a7642357a416ef558c703210578f8f4eff586976e851fca115","title":"Implement Auto-Generated Parameter Forms","description":"Create TemplateFormScreen in src/tui/screens/template_form.py.\n\nFeatures:\n- Auto-generate form fields from template metadata\n- Field validation\n- Default value population\n- Generate input preview\n- Create job with rendered input\n\nImplementation:\n- Parse template metadata (parameters, types, defaults)\n- Create Input widgets dynamically\n- Validate on submit\n- Render template with user values\n- Create job with generated input\n\nWidget types:\n- Input for text/numbers\n- Select for enums\n- Checkbox for booleans\n- TextArea for multi-line\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.3","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-20T23:24:20.573275-06:00","updated_at":"2025-11-21T07:02:13.273837-06:00","closed_at":"2025-11-21T07:02:13.273837-06:00","source_repo":".","labels":["phase-2","templates","ui"]}
{"id":"crystalmath-1om","content_hash":"e2feae7b69cf23f131dca646addb222c59deb75e1af7be108d35ac2d639fc035","title":"SSH runner status detection brittle","description":"ssh_runner.py:271-347 uses grep -i 'error|failed|abort' for status detection. Never surfaces actual exit codes, treats missing output.log as failure.\n\nFix:\n- Capture and return actual process exit codes\n- Use exit code as primary status indicator\n- Add retry/backoff for transient SSH errors\n- Handle missing output files gracefully\n- Improve error message clarity\n- Add robust status detection tests\n\nIssues:\n- Brittle regex-based status detection\n- No access to actual exit codes\n- Transient failures not retried\n- Poor error diagnostics\n\nFiles: tui/src/runners/ssh_runner.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:20.939684-06:00","updated_at":"2025-11-21T08:08:20.939684-06:00","source_repo":".","labels":["phase-2","reliability","remote-execution"]}
{"id":"crystalmath-22s","content_hash":"33556f824177a7f7d72799a46a7c2a8f820f8f21c71391901e380bb690052e3c","title":"Add shellcheck to CI","description":"Run shellcheck on all lib/*.sh and bin/runcrystal. Fix warnings","acceptance_criteria":"- shellcheck passes on all scripts\n- No warnings in lib/ modules\n- Main script clean\n- CI configured if applicable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.327616-06:00","updated_at":"2025-11-19T21:14:28.518209-06:00","closed_at":"2025-11-19T21:14:28.518209-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-22s","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.453955-06:00","created_by":"daemon"}]}
{"id":"crystalmath-28a","content_hash":"0ea17aa6c54c30a2aecb15226f6c11288b7c434bc6be9b01086cc2950fb0c71a","title":"Implement Template Browser UI","description":"Create TemplateBrowserScreen in src/tui/screens/template_browser.py.\n\nFeatures:\n- List all available templates\n- Preview template content\n- Show parameter descriptions\n- Launch parameter form\n- Search/filter templates\n\nUI components:\n- DataTable for template list\n- TextArea for preview (read-only)\n- Parameter info panel\n- 'Use Template' button\n\nImplementation:\n- Load templates on mount\n- Syntax highlight preview (if possible)\n- Handle template selection\n- Navigate to parameter form\n\nIntegration:\n- Action: 't' key for Template Browser\n- Pass selected template to parameter form\n- Generate input and create job\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:19.433113-06:00","updated_at":"2025-11-21T06:58:59.218752-06:00","closed_at":"2025-11-21T06:58:59.218752-06:00","source_repo":".","labels":["phase-2","templates","ui"]}
{"id":"crystalmath-3cv","content_hash":"8bd2f7fb2419c1f621a8aa0b44a0b351e4e9a8b70f8b4dec92bf33cc26825ec0","title":"Implement lib/cry-parallel.sh","description":"Parallelism logic and resource allocation. Function: parallel_setup(nprocs, job_state_ref) populates CRY_JOB array with MODE, EXE_PATH, OMP_NUM_THREADS, MPI_RANKS, THREADS_PER_RANK","design":"From gemini: Use name reference to CRY_JOB array. Calculate threads per rank. Export OMP_NUM_THREADS, I_MPI_PIN_DOMAIN, KMP_AFFINITY, OMP_STACKSIZE=256M. Return 0 on success","acceptance_criteria":"- parallel_setup() correctly calculates resources\n- Env vars exported properly\n- CRY_JOB array populated with all required keys\n- Serial and hybrid modes both work","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.813299-06:00","updated_at":"2025-11-19T20:57:48.155031-06:00","closed_at":"2025-11-19T20:57:48.155031-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-a2j","type":"blocks","created_at":"2025-11-19T20:36:49.807568-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.96926-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-rzw","type":"blocks","created_at":"2025-11-19T20:36:50.248531-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.478024-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.084005-06:00","created_by":"daemon"}]}
{"id":"crystalmath-3q8","content_hash":"675449fbc358fdc7f3aa9dd9e5e00b8657624ec637e319be9f4a9f61efcbdbcb","title":"Remove unused dependencies","description":"Heavy dependencies in tui/pyproject.toml are not referenced in code: pymatgen, ase, CRYSTALpytools, toml (verified with ripgrep).\n\nFix:\n- Remove unused dependencies from pyproject.toml\n- Or move to optional extras if planned for future\n- Update installation documentation\n- Run dependency audit for security vulnerabilities\n- Consider upper version bounds to prevent breaking upgrades\n\nImpact: Slower installs, larger attack surface, potential version conflicts, wasted bandwidth.\n\nUnused packages:\n- pymatgen\u003e=2023.0.0\n- ase\u003e=3.22.0\n- CRYSTALpytools\u003e=2023.0.0\n- toml\u003e=0.10.0\n\nFiles: tui/pyproject.toml\n\nNote: If these are needed for future features, document usage or move to [project.optional-dependencies].","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-21T12:15:38.274806-06:00","updated_at":"2025-11-21T12:15:38.274806-06:00","source_repo":".","labels":["dependencies","deployment","security"]}
{"id":"crystalmath-4x8","content_hash":"b7722a8c37a4bd6c5334d60f9a22ad76964a1f079f614259bb98f43953c47829","title":"SECURITY: Sandbox Jinja2 template engine","description":"templates.py:24-212 uses unsandboxed Jinja Environment with autoescape=False. User-supplied templates can execute arbitrary code, read files, and exfiltrate data.\n\nFix:\n- Use SandboxedEnvironment instead of Environment\n- Enable autoescape=True\n- Disable enable_async\n- Restrict available filters and functions\n- Validate template paths are under template_dir\n- Add template security tests\n\nImpact: Template injection leading to code execution and data exfiltration.\n\nFiles: tui/src/core/templates.py","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:45.228936-06:00","updated_at":"2025-11-21T08:07:45.228936-06:00","source_repo":".","labels":["critical","phase-2","security","templates"]}
{"id":"crystalmath-537","content_hash":"92b6f63f5f3ee8ff90d453f46cdbb836b06e2d9941cbd02e35129a513c617e25","title":"Add --explain/--dry-run educational mode","description":"Implement dry-run mode that shows hardware detection, parallel strategy, Intel optimizations, file staging plan, and execution command WITHOUT running calculation. Educational feature for students learning HPC.","design":"From V2/CrystalRun:136-225. Parse flag before input validation. Build explanation using cry-ui cards showing: 1) Hardware (cores, ranks), 2) Parallel strategy (thread calculation), 3) Intel opts (pinning, affinity, stack), 4) File staging (scratch dir, files to copy), 5) Execution command. Exit after display.","acceptance_criteria":"- --explain flag recognized\n- Shows 5-section breakdown\n- Uses ui_card for formatting\n- Exits without running calculation\n- Matches V2 educational quality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-19T23:00:47.743062-06:00","updated_at":"2025-11-19T23:55:11.808314-06:00","closed_at":"2025-11-19T23:55:11.808314-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-537","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.778488-06:00","created_by":"daemon"}]}
{"id":"crystalmath-53w","content_hash":"25e364a76a9a64a52bb0842ae9bc2e43c92aed27768407081a9fccd70db7e66e","title":"Environment detection breaks when packaged","description":"environment.py:53-67 auto-detects CRY23_ROOT via Path(__file__).parents[4], which breaks when installed via pip or if repo layout changes.\n\nFix:\n- Prefer CRY23_ROOT environment variable\n- Accept bashrc_path parameter explicitly\n- Raise actionable error if CRYSTAL23 not found\n- Document installation requirements\n- Add validation that cry23.bashrc exists\n\nImpact: Production pip installs won't find cry23.bashrc, causing startup failures.\n\nRecommendation:\n1. Check CRY23_ROOT env var first\n2. Fall back to explicit bashrc_path parameter\n3. Only use __file__ traversal as last resort\n4. Add clear error message with setup instructions\n\nFiles: tui/src/core/environment.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:13.624967-06:00","updated_at":"2025-11-21T12:14:13.624967-06:00","source_repo":".","labels":["deployment","environment","phase-1"]}
{"id":"crystalmath-5ab","content_hash":"6e7a625b5d173ee8436f2a6667c3fe22981efe4c7a54e2baafc0e73e6e3e1d45","title":"Add Comprehensive Unit Tests","description":"Test suite for core functionality. Include database CRUD operations, job state transitions, CRYSTALpytools integration, and mock runner tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T19:20:31.80782-06:00","updated_at":"2025-11-20T23:27:59.227307-06:00","closed_at":"2025-11-20T23:27:59.227307-06:00","source_repo":".","labels":["mvp","phase-1","testing"]}
{"id":"crystalmath-5nx","content_hash":"6d73ab4cfaf16234e678e2a974d85a1ed8c0696100eb90780785d76935a40538","title":"Move runcrystal to bin/runcrystal","description":"Relocate current monolithic script as reference, create new modular version in bin/","acceptance_criteria":"- Old script saved as runcrystal.monolithic\n- New script in bin/runcrystal\n- bin/runcrystal executable\n- PATH handling correct for lib/ discovery","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.024223-06:00","updated_at":"2025-11-19T21:06:33.40139-06:00","closed_at":"2025-11-19T21:06:33.40139-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-5nx","depends_on_id":"crystalmath-22s","type":"blocks","created_at":"2025-11-19T20:36:50.409227-06:00","created_by":"daemon"},{"issue_id":"crystalmath-5nx","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.234639-06:00","created_by":"daemon"}]}
{"id":"crystalmath-5w6","content_hash":"5c5a9c262e44c2d965e29303f7e9d318651a3f422362fd702e7181b9cc8298ab","title":"Centralize status string constants","description":"Status values are scattered as raw strings across database.py:135-213, queue_manager.py:533-569, and tests ('PENDING', 'QUEUED', 'RUNNING', etc.).\n\nFix:\n- Create central status constants module or enum\n- Define all valid job/workflow statuses\n- Add status transition validators\n- Update DB constraints to match\n- Replace all string literals with constants\n- Add status lifecycle tests\n\nImpact: Typo-prone code, hard to change lifecycle, inconsistent status handling across modules.\n\nExample:\n# Create src/core/status.py\nfrom enum import Enum\n\nclass JobStatus(str, Enum):\n    PENDING = 'pending'\n    QUEUED = 'queued'\n    RUNNING = 'running'\n    COMPLETED = 'completed'\n    FAILED = 'failed'\n    CANCELLED = 'cancelled'\n\nFiles:\n- tui/src/core/database.py\n- tui/src/core/queue_manager.py\n- tui/src/core/orchestrator.py\n- All test files","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:24.137746-06:00","updated_at":"2025-11-21T12:15:24.137746-06:00","source_repo":".","labels":["code-quality","maintainability","phase-2"]}
{"id":"crystalmath-6o9","content_hash":"e1b0249e8f1f223e601f57385acb5e5213405c45f13b22bfeba934d7aa4d89cb","title":"Update CLAUDE.md for refactored architecture","description":"Update CLAUDE.md with new structure, module descriptions, testing instructions","acceptance_criteria":"- CLAUDE.md reflects new architecture\n- Testing instructions included\n- Module responsibilities documented\n- Future maintainer can understand structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.398241-06:00","updated_at":"2025-11-19T21:09:14.22883-06:00","closed_at":"2025-11-19T21:09:14.22883-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-6o9","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.504523-06:00","created_by":"daemon"}]}
{"id":"crystalmath-6sp","content_hash":"13e5cce22ed38ac635fab3469d57677dc6edace2066483b98b9889103cc0a526","title":"Implement lib/cry-config.sh","description":"Central configuration module with cry_config_init(), path exports, environment checks. Handles CRY23_ROOT, BIN_DIR, SCRATCH_BASE. Supports env var overrides","design":"From codex: Use : ${VAR:=default} pattern. Export CRY_VERSION, CRY_ARCH, CRY_BIN_DIR. Implement cry_config_get() helper. Support optional cry.conf file","acceptance_criteria":"- cry_config_init() function works\n- All path variables exported correctly\n- Env var overrides functional\n- Module sources without errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.665915-06:00","updated_at":"2025-11-19T20:50:45.304565-06:00","closed_at":"2025-11-19T20:50:45.304565-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.551905-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.620586-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-3cv","type":"blocks","created_at":"2025-11-19T20:36:49.669549-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-hyl","type":"blocks","created_at":"2025-11-19T20:36:49.715592-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-ib2","type":"blocks","created_at":"2025-11-19T20:36:49.76152-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.877184-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-nim","type":"blocks","created_at":"2025-11-19T20:36:50.155165-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.431332-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:06.985439-06:00","created_by":"daemon"}]}
{"id":"crystalmath-6vn","content_hash":"a57437acab47c030f564fed26c728a16fec2e854fa5683c9b5e75fac51579a43","title":"Refactor main bin/runcrystal script","description":"Transform runcrystal into thin orchestrator \u003c100 lines. Implement main() function with module loading, argument parsing, pipeline execution","design":"From gemini: Use trap 'scratch_cleanup' EXIT. Declare -A CRY_JOB for state. Load modules in order: config, logging, core, ui, help, parallel, scratch, stage, exec. Call functions in pipeline. From codex: Implement cry_workflow_entry for orchestration","acceptance_criteria":"- Main script \u003c100 lines\n- All modules loaded correctly\n- trap-based cleanup works\n- Preserves all original functionality\n- Error handling robust","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.989123-06:00","updated_at":"2025-11-20T23:22:37.246987-06:00","closed_at":"2025-11-20T23:22:37.246987-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-5nx","type":"blocks","created_at":"2025-11-19T20:36:50.086025-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-z00","type":"blocks","created_at":"2025-11-19T20:36:50.386766-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-6o9","type":"blocks","created_at":"2025-11-19T20:36:50.594694-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.211255-06:00","created_by":"daemon"}]}
{"id":"crystalmath-75z","content_hash":"c3b13465cfb4690484bcf6a0ff2c733cf1dcdc43a43e220be1a4d567a3b01334","title":"Configure SQLite for concurrent access","description":"database.py:86-96 opens SQLite with defaults, no WAL/busy_timeout/journal_mode tuning. Background scheduler + UI threads will hit 'database is locked' errors and slow commits.\n\nFix:\n- Set PRAGMA journal_mode=WAL on init\n- Set PRAGMA busy_timeout=5000 (5 seconds)\n- Set PRAGMA synchronous=NORMAL\n- Wrap write operations in 'with self.conn:' context managers\n- Add connection pooling for multiple readers\n\nImpact: Prevents 'database is locked' errors under concurrent access from UI and scheduler.\n\nBefore:\nself.conn = sqlite3.connect(str(db_path), check_same_thread=False)\n\nAfter:\nself.conn = sqlite3.connect(str(db_path), check_same_thread=False)\nself.conn.execute('PRAGMA journal_mode=WAL')\nself.conn.execute('PRAGMA busy_timeout=5000')\nself.conn.execute('PRAGMA synchronous=NORMAL')\n\nFiles: tui/src/core/database.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:13:49.358039-06:00","updated_at":"2025-11-21T12:13:49.358039-06:00","source_repo":".","labels":["concurrency","database","performance","phase-2"]}
{"id":"crystalmath-7e1","content_hash":"352c4e50cf99a83a689f01d795916609e61df7273c0e3821e93d167d48887314","title":"Write module documentation","description":"Document each lib/ module: purpose, functions, parameters, return codes, usage examples","acceptance_criteria":"- Each module has header documentation\n- Function signatures documented\n- Examples provided\n- References to design decisions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.363784-06:00","updated_at":"2025-11-20T23:24:34.259681-06:00","closed_at":"2025-11-20T23:24:34.259681-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-7e1","depends_on_id":"crystalmath-ps0","type":"blocks","created_at":"2025-11-19T20:36:50.622011-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7e1","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.478814-06:00","created_by":"daemon"}]}
{"id":"crystalmath-7jf","content_hash":"6168297aecbe71833b6fb7f2c917bcd25858fc84b36c06cbb0b0a973bb0e5655","title":"Set up testing framework (bats)","description":"Install bats-core, create tests/ directory structure, write test harness and mock utilities","design":"From codex: Mock external commands via CRY_CMD_MPIRUN, CRY_CMD_GUM vars. Create tests/mocks/ for fake binaries. Set up tests/helpers.bash for common test functions","acceptance_criteria":"- bats-core installed\n- tests/ directory structure created\n- Mock framework implemented\n- Helper functions available","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.061984-06:00","updated_at":"2025-11-19T20:50:46.283658-06:00","closed_at":"2025-11-19T20:50:46.283658-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-nim","type":"blocks","created_at":"2025-11-19T20:36:50.132295-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-pq3","type":"blocks","created_at":"2025-11-19T20:36:50.178562-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-rzw","type":"blocks","created_at":"2025-11-19T20:36:50.225654-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-pc3","type":"blocks","created_at":"2025-11-19T20:36:50.271326-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-dmt","type":"blocks","created_at":"2025-11-19T20:36:50.317159-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-z00","type":"blocks","created_at":"2025-11-19T20:36:50.363563-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.258432-06:00","created_by":"daemon"}]}
{"id":"crystalmath-7o7","content_hash":"268368422731b195138e2853740ecddcb420ac820a5845eb65fd677dd26d03da","title":"Implement Connection Manager","description":"Create ConnectionManager class in src/core/connections.py.\n\nFeatures:\n- Register multiple clusters\n- Get runner instance for cluster\n- List available clusters\n- Validate cluster connectivity\n- Health monitoring\n\nImplementation:\n\n\nIntegration:\n- Load clusters from database on startup\n- Expose to TUI app\n- Cache runner instances\n\nTesting:\n- Mock cluster configuration\n- Test connection pooling\n- Test error handling\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.4","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:13.144331-06:00","updated_at":"2025-11-21T06:55:17.806431-06:00","closed_at":"2025-11-21T06:55:17.806431-06:00","source_repo":".","labels":["core","phase-2","remote-execution"]}
{"id":"crystalmath-8bp","content_hash":"07408f4ce4a0e21dbccbe2ff4a48e420031c3cf8c2cdc5e28f341d3cc863aa6c","title":"Implement Workflow Orchestrator","description":"Create WorkflowOrchestrator class in src/core/orchestrator.py.\n\nFeatures:\n- Execute multi-step workflows\n- Monitor step completion\n- Pass data between steps\n- Handle failures and retries\n- Conditional execution\n\nImplementation:\n\n\nKey logic:\n- Loop: get ready steps → submit → wait → check completion\n- Parse output from completed steps\n- Use parsed data as input for dependent steps\n- Update workflow status in database\n\nDatabase:\n- workflows table\n- workflow_jobs table (links jobs to workflows)\n\nSee: tui/docs/PHASE2_DESIGN.md section 3.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:17.665121-06:00","updated_at":"2025-11-21T06:58:40.370695-06:00","closed_at":"2025-11-21T06:58:40.370695-06:00","source_repo":".","labels":["orchestration","phase-2","workflow"]}
{"id":"crystalmath-8gv","content_hash":"a9a0673298ef1ce5488b7481638dc05a137d59621039ecc322b7145123f27cce","title":"Implement Workflow DAG System","description":"Create workflow DAG system in src/core/workflow.py.\n\nClasses:\n- WorkflowStep: Single calculation step\n- Workflow: Collection of steps with dependencies\n- WorkflowOrchestrator: Executes workflows\n\nFeatures:\n- DAG representation (steps + dependencies)\n- Dependency resolution\n- Parallel step execution\n- Error handling and recovery\n- Progress tracking\n\nImplementation:\n\n\nTesting:\n- Test dependency resolution\n- Test parallel execution\n- Test error propagation\n\nSee: tui/docs/PHASE2_DESIGN.md section 3.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:16.826449-06:00","updated_at":"2025-11-21T06:59:03.173954-06:00","closed_at":"2025-11-21T06:59:03.173954-06:00","source_repo":".","labels":["core","phase-2","workflow"]}
{"id":"crystalmath-8so","content_hash":"8ee0c5508a543653f044dee8d5f030088dec8a753d678e0e45280c57d51e984f","title":"Improve observability in background loops","description":"Orchestrator uses print() and silent 'except Exception' in background monitor (orchestrator.py:694-714), losing stack traces. QueueManager logging defaults to WARNING level.\n\nFix:\n- Replace print() with module-level logger\n- Add structured logging with context (job_id, workflow_id)\n- Configure logging in entrypoint (level, format, handlers)\n- Bubble exceptions to handler instead of swallowing\n- Add log rotation and retention policy\n- Surface errors via Textual notifications\n\nImpact: Difficult incident triage, lost stack traces, poor debugging experience.\n\nExample:\n# Replace:\ntry:\n    ...\nexcept Exception as e:\n    print(f'Error: {e}')\n\n# With:\nlogger = logging.getLogger(__name__)\ntry:\n    ...\nexcept Exception:\n    logger.exception('Workflow monitor error', extra={'workflow_id': wf_id})\n    raise\n\nFiles:\n- tui/src/core/orchestrator.py\n- tui/src/core/queue_manager.py","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:30.779865-06:00","updated_at":"2025-11-21T12:15:30.779865-06:00","source_repo":".","labels":["logging","observability","phase-2"]}
{"id":"crystalmath-9kt","content_hash":"01763e54094525eb8ec311eb610b3338a3df4f4b631dba858d501e21f9a27d1b","title":"SECURITY: Enable SSH host key verification","description":"connection_manager.py:84-137 uses known_hosts=None, disabling host key verification. This exposes all remote execution to MITM attacks.\n\nFix:\n- Remove known_hosts=None parameter\n- Add strict host key checking config option\n- Support known_hosts file path configuration\n- Add host key fingerprint verification\n- Document host key setup process\n\nImpact: All SSH and SLURM runners vulnerable to man-in-the-middle attacks.\n\nFiles: tui/src/core/connection_manager.py","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:43.789762-06:00","updated_at":"2025-11-21T08:07:43.789762-06:00","source_repo":".","labels":["critical","phase-2","remote-execution","security"]}
{"id":"crystalmath-a2j","content_hash":"da43585e7d89c86a5d9bc2a37b9dc52032ad84ee00cc6aecf101fcb4197825d0","title":"Implement lib/cry-exec.sh","description":"Calculation execution module. Function: exec_run(job_state_ref) constructs and executes crystal/mpirun command, handles gum spin wrapper, returns exit code","design":"From gemini: Read CRY_JOB array to build command. Execute in scratch directory. Wrap with gum spin if available. Return actual exit code for status reporting","acceptance_criteria":"- exec_run() builds correct commands\n- Serial mode uses crystalOMP\n- Parallel mode uses mpirun + PcrystalOMP\n- Exit code properly returned\n- gum spin integration works","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.919546-06:00","updated_at":"2025-11-19T20:56:48.771185-06:00","closed_at":"2025-11-19T20:56:48.771185-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.041441-06:00","created_by":"daemon"},{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.548204-06:00","created_by":"daemon"},{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.163205-06:00","created_by":"daemon"}]}
{"id":"crystalmath-a9n","content_hash":"0c894fc063fb00e9743d18af61c1cc7e0364b1ae2b783e452a773d7b7770cd69","title":"Implement SLURM Runner for batch submission","description":"Create SLURMRunner class in src/runners/slurm.py for SLURM integration.\n\nKey features:\n- Dynamic SLURM script generation\n- Job submission via sbatch\n- Non-blocking status polling with squeue\n- Job array support for parameter sweeps\n- Automatic result retrieval on completion\n\nImplementation:\n- Extends BaseRunner interface\n- Uses SSHRunner internally for SSH operations\n- Implements _generate_slurm_script() for script generation\n- Implements _check_status() for job monitoring\n- Polls every 30 seconds (configurable)\n\nTesting:\n- Mock SSH commands (sbatch, squeue)\n- Test script generation\n- Test status parsing\n- Test job array submission\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.3","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:08.923256-06:00","updated_at":"2025-11-21T06:55:36.923725-06:00","closed_at":"2025-11-21T06:55:36.923725-06:00","source_repo":".","labels":["phase-2","remote-execution","slurm"]}
{"id":"crystalmath-am9","content_hash":"4a4fd5e778f96092e5c7a182de9b7d2b3dc8443194e79d993c7c802b36e7978a","title":"Remove .bak backup scripts from cli/lib","description":"Dead backup files linger in cli/lib directory alongside active modules:\n- cli/lib/cry-parallel.sh.bak\n- cli/lib/cry-stage.sh.bak\n- cli/lib/cry-ui.sh.bak\n\nFix:\n- Delete .bak files or archive outside repository\n- Ensure module loader only ships canonical modules\n- Update .gitignore to exclude .bak files\n- Clean up any other backup/temp files\n- Document that git history preserves old versions\n\nImpact: Contributors may load wrong file, doubles maintenance burden, confusing repository structure.\n\nFiles: cli/lib/*.bak\n\nRecommendation: Delete and rely on git history for recovery if needed.","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:45.134755-06:00","updated_at":"2025-11-21T12:15:45.134755-06:00","source_repo":".","labels":["cleanup","cli","maintainability"]}
{"id":"crystalmath-as9","content_hash":"6811649b8a9a1b947fd89ed96fb1088b1bcf567b967ea4d864b9561607acf0e4","title":"Create BaseRunner abstract interface","description":"Define BaseRunner abstract base class in src/runners/base.py.\n\nInterface methods:\n- async run_job(job_id, work_dir, threads) -\u003e AsyncIterator[str]\n- async stop_job(job_id) -\u003e bool\n- is_job_running(job_id) -\u003e bool\n- get_process_pid(job_id) -\u003e Optional[int]\n\nPurpose:\n- Unified interface for LocalRunner, SSHRunner, SLURMRunner\n- Type hints for runner implementations\n- Enforces contract for all execution backends\n\nImplementation:\n- Use abc.ABC and @abstractmethod\n- Document expected behavior for each method\n- Add type hints for all parameters\n\nDependencies:\n- None (creates new module)\n\nBlocks:\n- SSH Runner implementation\n- SLURM Runner implementation\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.1","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:10.269958-06:00","updated_at":"2025-11-21T06:56:03.252796-06:00","closed_at":"2025-11-21T06:56:03.252796-06:00","source_repo":".","labels":["architecture","phase-2","remote-execution"]}
{"id":"crystalmath-awi","content_hash":"a3161af2716cf650f93ee67e9b0460a57ddd41cbec8a5f01a0733369b33b1c42","title":"Add Input File Preview","description":"Display selected job's input file in Input tab. Load .d12 file when job selected, add syntax highlighting for CRYSTAL input, and provide read-only view for completed jobs.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:28.769112-06:00","updated_at":"2025-11-20T23:25:21.403257-06:00","closed_at":"2025-11-20T23:25:21.403257-06:00","source_repo":".","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-be3","content_hash":"566f4a73d760fb2780c8344d6526c70ee6fefb34f1a21c49f3eb4e09baa8b8aa","title":"Implement lib/cry-ui.sh (visual components)","description":"Move visual functions from runcrystal:74-118. Includes ui_banner(), ui_card(), ui_status_line(), ui_file_found(), ui_spin(). Implements theme system","design":"From gemini: Functions use CRY_THEME associative array. From codex: Implement cry_ui_init() to handle gum bootstrap, set CRY_HAS_GUM flag, graceful degrade to plain text when gum missing. Theme registry pattern for cry-docs reuse","acceptance_criteria":"- All UI functions extracted from runcrystal\n- Theme system implemented with CRY_THEME_DEFAULT\n- Graceful fallback when gum missing\n- Module testable independently","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.777197-06:00","updated_at":"2025-11-19T20:57:16.162002-06:00","closed_at":"2025-11-19T20:57:16.162002-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-3cv","type":"blocks","created_at":"2025-11-19T20:36:49.693572-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-hyl","type":"blocks","created_at":"2025-11-19T20:36:49.737708-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-ib2","type":"blocks","created_at":"2025-11-19T20:36:49.784108-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-a2j","type":"blocks","created_at":"2025-11-19T20:36:49.831244-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-wwa","type":"blocks","created_at":"2025-11-19T20:36:49.853996-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.945857-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-pq3","type":"blocks","created_at":"2025-11-19T20:36:50.202927-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.454496-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.05997-06:00","created_by":"daemon"}]}
{"id":"crystalmath-bj8","content_hash":"c846d4d1b5ddeb57a63cae93f7e81016563b01dfe229433556967f7f24a573e7","title":"Implement Template System with Jinja2","description":"Create TemplateManager class in src/core/templates.py.\n\nFeatures:\n- Jinja2-based template rendering\n- Template metadata parsing\n- Parameter validation\n- Template library management\n\nImplementation:\n\n\nTemplate format:\n- Use .j2 extension\n- Metadata in header comments\n- Parameter documentation\n- Default values\n\nExample templates:\n- optimization.d12.j2 (geometry optimization)\n- scf.d12.j2 (single point calculation)\n- bands.d12.j2 (band structure)\n- dos.d12.j2 (density of states)\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:18.403006-06:00","updated_at":"2025-11-21T06:58:01.423995-06:00","closed_at":"2025-11-21T06:58:01.423995-06:00","source_repo":".","labels":["core","phase-2","templates"]}
{"id":"crystalmath-d9k","content_hash":"bc1d2d6e79e4d8cd33abe4f10719fcbbbedb03a2b6c593e574b60a9f5bd76be2","title":"Implement Queue Manager for job scheduling","description":"Create QueueManager class in src/core/queue.py for priority-based job queue.\n\nKey features:\n- Priority-based job queue\n- Automatic submission when resources available\n- Queue status monitoring\n- Configurable submission rate\n\nMain methods:\n- enqueue: Add job with priority\n- submit_next: Submit next job from queue\n- get_queue_status: Get current queue state\n- clear_queue: Empty the queue\n- pause/resume: Control automatic submission\n\nIntegration:\n- Background worker for automatic submission\n- Respect scheduler limits\n- Handle submission failures\n- Rate limiting between submissions\n\nTesting:\n- Test priority sorting\n- Test automatic submission\n- Test pause/resume functionality\n\nSee: tui/docs/PHASE2_DESIGN.md section 2.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:29.845912-06:00","updated_at":"2025-11-21T06:59:18.731639-06:00","closed_at":"2025-11-21T06:59:18.731639-06:00","source_repo":".","labels":["batch","core","phase-2"]}
{"id":"crystalmath-dmt","content_hash":"b2a25450d91f9a296a0a73e28dbf31759a6dbc440bd79dc277af8852868c6e10","title":"Write unit tests for lib/cry-stage.sh","description":"Test file staging, retrieval, missing file handling","acceptance_criteria":"- Test stage_inputs() copies files correctly\n- Test stage_retrieve_results()\n- Test missing file handling\n- Test explicit path usage\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.253695-06:00","updated_at":"2025-11-20T00:40:41.589542-06:00","closed_at":"2025-11-20T00:40:41.589542-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-dmt","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.402954-06:00","created_by":"daemon"}]}
{"id":"crystalmath-drj","content_hash":"d6cd3a6253253721a254b16afea078fa6079883a9808fa63b0c909bd654cf8d8","title":"Queue manager race conditions","description":"queue_manager.py:139-233,409-489 uses shared dicts without consistent locking. _scheduler_worker reads/writes _jobs while enqueue/dequeue hold lock separately.\n\nFix:\n- Add consistent locking around all _jobs/_clusters access\n- Avoid calling schedule_jobs outside lock\n- Batch DB queries instead of per-job SELECT each tick\n- Add lock ordering discipline\n- Test concurrent enqueue/dequeue scenarios\n- Add deadlock prevention\n\nIssues:\n- Race conditions on shared state\n- Lost updates from concurrent modifications\n- Poor scalability (DB query per job per tick)\n\nFiles: tui/src/core/queue_manager.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:18.009111-06:00","updated_at":"2025-11-21T08:08:18.009111-06:00","source_repo":".","labels":["concurrency","phase-2","queue","reliability"]}
{"id":"crystalmath-ejy","content_hash":"8b7dfb8296b1bda32f2f5256b451415d5f13fbfd2d87b123fcd128f025d76a7c","title":"Implement module loader (cry_require)","description":"Create lib/core.sh with cry_require() function for safe module loading with error handling","design":"From codex: Check file exists before source, emit helpful errors for missing modules, return non-zero on failure. Allow main script to loop through module list","acceptance_criteria":"- cry_require() loads modules safely\n- Missing module errors are helpful\n- Returns appropriate exit codes\n- Works with module dependency order","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.740574-06:00","updated_at":"2025-11-19T20:52:31.893411-06:00","closed_at":"2025-11-19T20:52:31.893411-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.597902-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.923232-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.035547-06:00","created_by":"daemon"}]}
{"id":"crystalmath-fcq","content_hash":"a34ef096fa66aeaa10cf4246624ba7a4a4709b5b9e9f4b0cd64cf84f936a3338","title":"Extend database schema for remote jobs","description":"Add new tables to support remote execution and clusters.\n\nNew tables:\n- clusters: Store cluster connection information\n- remote_jobs: Link jobs to clusters and track scheduler IDs\n- Add cluster_id column to existing jobs table\n\nSchema changes:\n\n\nImplementation:\n- Add migration logic to Database class\n- Add CRUD methods for clusters\n- Add methods to link jobs to clusters\n- Handle backward compatibility\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.5","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:12.283543-06:00","updated_at":"2025-11-21T06:56:04.353603-06:00","closed_at":"2025-11-21T06:56:04.353603-06:00","source_repo":".","labels":["database","phase-2","remote-execution"]}
{"id":"crystalmath-g1i","content_hash":"45cc56ab89f2b4843920a8c3b77c89a47cf14c8e3f3fd33aa5650306602e2be1","title":"Database migrations not transactional","description":"database.py:87-186 migration from v1 to v2 is not wrapped in a transaction. Partial failures are silently ignored, can leave half-applied schema.\n\nFix:\n- Wrap entire migration in explicit transaction\n- Verify schema after migration\n- Add rollback on any failure\n- Test migration failure scenarios\n- Add schema version validation\n- Backfill existing rows with FK consistency checks\n\nRisks:\n- Data corruption from partial schema updates\n- Foreign key constraint violations\n- Inconsistent database state after crash\n\nFiles: tui/src/core/database.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:17.033933-06:00","updated_at":"2025-11-21T08:08:17.033933-06:00","source_repo":".","labels":["database","phase-2","reliability"]}
{"id":"crystalmath-g4p","content_hash":"c232439834370ab7ea6a96fcc07e351a0bbc65964a761c695551c21a7227d764","title":"Create tutorial module system from MASTER_TUTORIAL.md","description":"Split MASTER_TUTORIAL.md into separate tutorial files matching V2 help menu: usage.md, parallelism.md, intel_opts.md, scratch.md, troubleshooting.md. Install to share/tutorials/","design":"Extract sections from MASTER_TUTORIAL.md using SECTION markers. Create 5 markdown files in share/tutorials/. Update help_show_main() to use show_tutorial() function (like V2:94-108) that displays files with gum pager --soft-wrap.","acceptance_criteria":"- 5 tutorial files created\n- Matches V2 menu structure\n- Markdown formatting preserved\n- help_show_main updated\n- Tutorials display correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T23:00:50.061432-06:00","updated_at":"2025-11-19T23:55:25.054325-06:00","closed_at":"2025-11-19T23:55:25.054325-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-g4p","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.832772-06:00","created_by":"daemon"}]}
{"id":"crystalmath-hai","content_hash":"edf1daff3b071515345c2c5d74179680f365ab2b44696f4b858fe36728d95926","title":"Enhance Job Status Display","description":"Improve job list table with better status indicators. Add color-coded status (green=completed, red=failed, yellow=running), progress indicators for running jobs, timestamps for created/started/completed, and sortable columns.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:27.245956-06:00","updated_at":"2025-11-20T23:25:04.940838-06:00","closed_at":"2025-11-20T23:25:04.940838-06:00","source_repo":".","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-hyl","content_hash":"2b76aa0f3e7f52585f3aa51c7c20e011617aee99aec73679a19d0477a41309cb","title":"Implement lib/cry-scratch.sh","description":"Scratch space lifecycle management. Functions: scratch_create(file_prefix) creates unique dir in SCRATCH_BASE, exports WORK_DIR. scratch_cleanup() removes scratch dir idempotently","design":"From gemini: Use trap 'scratch_cleanup' EXIT in main script. Safe to call cleanup even if creation failed. From codex: Return 70 for validation failures","acceptance_criteria":"- scratch_create() generates unique directories\n- WORK_DIR exported correctly\n- scratch_cleanup() is idempotent\n- Works with trap mechanism","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.849221-06:00","updated_at":"2025-11-19T20:55:33.203349-06:00","closed_at":"2025-11-19T20:55:33.203349-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.99272-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-pc3","type":"blocks","created_at":"2025-11-19T20:36:50.294435-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.501139-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.108019-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ib2","content_hash":"4bff8f302ea1894090dd6d77a3d87ce200c6550ba5d999c2adf1afe39c7304e9","title":"Implement lib/cry-stage.sh","description":"File staging utilities. Functions: stage_inputs(file_prefix, work_dir, original_dir) copies input/aux files to scratch. stage_retrieve_results() copies outputs back","design":"From gemini: Move file mapping from lines 295-301, 361-367 to cry-config as associative arrays STAGE_MAP, RETRIEVE_MAP. Functions accept explicit dir arguments instead of relying on pwd","acceptance_criteria":"- stage_inputs() copies all required files\n- stage_retrieve_results() retrieves outputs\n- Uses explicit path arguments\n- Handles missing files gracefully","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.884651-06:00","updated_at":"2025-11-19T20:55:39.606558-06:00","closed_at":"2025-11-19T20:55:39.606558-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.017047-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-dmt","type":"blocks","created_at":"2025-11-19T20:36:50.340079-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.524587-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.135967-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ikl","content_hash":"0d6ab496c450fdc98a7c5a913c6d5e3e92873a47a3ab5e4940ea9d4f7206444b","title":"Create project directory structure","description":"Create bin/, lib/, tests/, docs/ directories. Set up initial .gitignore","acceptance_criteria":"- Directories created\n- .gitignore includes tmp_crystal/, .beads/ backup files\n- README.md updated with new structure","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.625726-06:00","updated_at":"2025-11-19T20:46:28.005003-06:00","closed_at":"2025-11-19T20:46:28.005003-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-6sp","type":"blocks","created_at":"2025-11-19T20:36:49.480865-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-lcc","type":"blocks","created_at":"2025-11-19T20:36:49.506133-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.528672-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-7jf","type":"blocks","created_at":"2025-11-19T20:36:50.109912-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:06.961671-06:00","created_by":"daemon"}]}
{"id":"crystalmath-jmt","content_hash":"9a29b6a21d1b828bdd7e2c9e626ba466318cc8e71551baa62dc512b4255771bb","title":"Integrate cry23.bashrc Environment","description":"Connect to existing CRYSTAL23 environment configuration. Source cry23.bashrc for environment variables, use CRY23_EXEDIR for executable path, respect CRY23_SCRDIR for scratch directory, handle missing environment gracefully.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T19:20:26.142779-06:00","updated_at":"2025-11-20T23:24:24.808242-06:00","closed_at":"2025-11-20T23:24:24.808242-06:00","source_repo":".","labels":["integration","mvp","phase-1"]}
{"id":"crystalmath-lac","content_hash":"4d1440d1d790bb10ba8146c813a5cbdddb430cf893be9fe53dd5de19e702512b","title":"Duplicate dependency resolution logic","description":"Orchestrator and QueueManager both implement dependency resolution and state tracking independently. Orchestrator has _validate_dag/_dependencies_met while QueueManager has _validate_dependencies/_dependencies_satisfied.\n\nFix:\n- Consolidate DAG validation into single layer (QueueManager)\n- Have Orchestrator call QueueManager's dependency logic\n- Extract shared dependency graph utilities\n- Define single source of truth for job lifecycle\n- Add comprehensive dependency resolution tests\n\nImpact: Divergent rules, duplicated work, harder to reason about correctness, risk of inconsistent behavior.\n\nFiles:\n- tui/src/core/orchestrator.py (DAG validation)\n- tui/src/core/queue_manager.py (dependency checking)\n\nRecommendation: Create shared workflow/dependency.py module with unified logic.\n\nDependencies: Consider crystalmath-8gv (Workflow DAG) refactoring.","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-21T12:15:16.479008-06:00","updated_at":"2025-11-21T12:15:16.479008-06:00","source_repo":".","labels":["architecture","orchestration","phase-2","queue"]}
{"id":"crystalmath-lcc","content_hash":"8878283f64154a28dcfdc6de9ff6821d3c039d4e816e85495b4b093e833e9b3b","title":"Implement lib/cry-logging.sh","description":"Logging infrastructure with cry_log(), cry_fatal(), cry_warn() functions. Structured output for debugging","design":"From codex: cry_fatal() returns exit code, doesn't call exit. cry_log levels: debug, info, warn, error. Support CRY_LOG_LEVEL env var","acceptance_criteria":"- cry_log() function works with levels\n- cry_fatal() returns non-zero\n- Log output includes timestamps\n- Respects log level filtering","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.702964-06:00","updated_at":"2025-11-19T20:50:22.965951-06:00","closed_at":"2025-11-19T20:50:22.965951-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.574097-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.644519-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.900194-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.01077-06:00","created_by":"daemon"}]}
{"id":"crystalmath-nim","content_hash":"7efd67defbcdb3704f0ff0566cac7af96ba8a95374c77cd1a5168587a212e05a","title":"Write unit tests for lib/cry-config.sh","description":"Test configuration initialization, env var overrides, path construction, cry_config_get()","acceptance_criteria":"- Test cry_config_init() \n- Test env var override behavior\n- Test path variable exports\n- Test cry_config_get() helper\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.098633-06:00","updated_at":"2025-11-20T00:40:36.148444-06:00","closed_at":"2025-11-20T00:40:36.148444-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-nim","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.284252-06:00","created_by":"daemon"}]}
{"id":"crystalmath-oxy","content_hash":"320dfffa682fcbf4918de653458ddad06ce818da501a013d663107294344d12a","title":"Refactor runcrystal into modular architecture","description":"Transform monolithic 372-line runcrystal script into production-grade modular CLI tool with separate lib/ modules, shared UI components, and comprehensive testing","design":"Architecture based on gemini/codex analysis: cry-config, cry-ui, cry-parallel, cry-scratch, cry-stage, cry-exec, cry-help modules. Main script becomes thin orchestrator \u003c100 lines. Use CRY_JOB associative array for state passing. Implement trap-based cleanup guarantee.","acceptance_criteria":"- All modules created and tested independently\n- Main runcrystal script \u003c100 lines\n- Zero functionality regression\n- Test coverage \u003e80%\n- Documentation complete\n- cry-docs can reuse UI components","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-19T20:35:09.537435-06:00","updated_at":"2025-11-20T00:40:56.402673-06:00","closed_at":"2025-11-20T00:40:56.402673-06:00","source_repo":"."}
{"id":"crystalmath-pc3","content_hash":"c0944449f9c267906d349a7e0735151f1e77f09ceb5bd112cd8da148cde1641f","title":"Write unit tests for lib/cry-scratch.sh","description":"Test scratch creation, cleanup, idempotency, trap integration","acceptance_criteria":"- Test scratch_create() unique dirs\n- Test scratch_cleanup() idempotent\n- Test cleanup on error conditions\n- Verify no orphaned directories\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.218728-06:00","updated_at":"2025-11-20T00:40:41.58912-06:00","closed_at":"2025-11-20T00:40:41.58912-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-pc3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.375628-06:00","created_by":"daemon"}]}
{"id":"crystalmath-poz","content_hash":"19704bb7e5dffc1fb4d061bef1f84167e9aab5078a6327afed2f1767f55b5e66","title":"Template path traversal vulnerability","description":"templates.py:237-307 TemplateManager loads arbitrary paths without restricting to template_dir. Combined with unsandboxed Jinja = file read vulnerability.\n\nFix:\n- Validate all template paths are under template_dir\n- Use Path.resolve() and check parent\n- Reject paths with .. or absolute paths\n- Add path validation tests\n- Document template security model\n\nImpact: Path traversal can read arbitrary YAML files, combined with unsandboxed Jinja enables code execution.\n\nFiles: tui/src/core/templates.py\n\nDependencies: Blocked by crystalmath-4x8 (Jinja sandbox)","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:22.913047-06:00","updated_at":"2025-11-21T08:08:22.913047-06:00","source_repo":".","labels":["phase-2","security","templates"]}
{"id":"crystalmath-pq3","content_hash":"2201a9d074a11fbe5d2556187e6cada57a0c945cf22711d00c873a008bc0621b","title":"Write unit tests for lib/cry-ui.sh","description":"Test UI functions with and without gum, theme system, graceful degradation","acceptance_criteria":"- Test ui_banner(), ui_card(), ui_status_line()\n- Test with HAS_GUM=true and false\n- Test theme system\n- Verify graceful degradation\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.139819-06:00","updated_at":"2025-11-20T00:40:41.588066-06:00","closed_at":"2025-11-20T00:40:41.588066-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-pq3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.308856-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ps0","content_hash":"f0aa577902502e6beef1a7cbe48a162381a11be52a0600dab9902c15753c9126","title":"Create developer documentation (CONTRIBUTING.md)","description":"Document: how to add new modules, testing requirements, code style, module conventions","acceptance_criteria":"- CONTRIBUTING.md created\n- Module creation guide included\n- Testing requirements clear\n- Code style documented","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.434779-06:00","updated_at":"2025-11-19T21:09:36.094457-06:00","closed_at":"2025-11-19T21:09:36.094457-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-ps0","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.527853-06:00","created_by":"daemon"}]}
{"id":"crystalmath-qt1","content_hash":"d86d82eb32a564db22bbb5b88535e365fb5b50dfab7ec34b9e82216c9aa79033","title":"Implement New Job Modal Screen","description":"Create modal screen for job creation with input editor. Include TextArea widget for .d12 input content, Input field for job name, validation before job creation, and write input.d12 to work directory.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-20T19:20:24.783967-06:00","updated_at":"2025-11-20T23:25:50.486124-06:00","closed_at":"2025-11-20T23:25:50.486124-06:00","source_repo":".","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-r7z","content_hash":"0b3bb2ef6fdbbb3b464d67c2d2c66756e8fc5113038a039ae5c80c2bf2d33b93","title":"Connection manager cleanup issues","description":"connection_manager.py:201-245 health check loop may not stop cleanly after stop() unless task cancelled. Stale pooled connections outlive application lifecycle.\n\nFix:\n- Ensure health check task stops on manager.stop()\n- Add explicit connection cleanup on shutdown\n- Set connection timeouts and max idle time\n- Add connection leak detection\n- Implement graceful degradation on health check failures\n- Test lifecycle management\n\nIssues:\n- Health check loop continues after stop()\n- Stale connections not cleaned up\n- Resource leaks on application shutdown\n\nFiles: tui/src/core/connection_manager.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:19.109654-06:00","updated_at":"2025-11-21T08:08:19.109654-06:00","source_repo":".","labels":["phase-2","reliability","remote-execution"]}
{"id":"crystalmath-rfj","content_hash":"51511a83808e88c03239d461a2c61839e31c23000e32225aa2bbfce170cfce8b","title":"CRITICAL: Orchestrator doesn't submit jobs to runners","description":"orchestrator.py:196-230,298-343 has TODO in _submit_node - never actually calls queue manager or runners. Workflows report success without executing anything.\n\nFix:\n- Implement _submit_node to call queue_manager.enqueue()\n- Wire runner callbacks to update workflow state\n- Ensure atomic DB updates for job/workflow status\n- Add orchestrator-to-runner integration tests\n- Cleanup /tmp/workflow_* directories on completion\n- Add proper error handling and retry logic\n\nImpact: SHOWSTOPPER - workflows don't run, report false success.\n\nFiles: tui/src/core/orchestrator.py","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:49.524286-06:00","updated_at":"2025-11-21T08:07:49.524286-06:00","source_repo":".","labels":["critical","orchestration","phase-2","workflow"]}
{"id":"crystalmath-rzw","content_hash":"4df1013b22e4957f19b4be3b7e27a62300cde8710114d7205736433b386e233f","title":"Write unit tests for lib/cry-parallel.sh","description":"Test resource calculation, env var exports, CRY_JOB array population","acceptance_criteria":"- Test serial mode (nprocs=0)\n- Test hybrid mode (various nprocs)\n- Test thread calculation\n- Test env var exports\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.179675-06:00","updated_at":"2025-11-20T00:40:41.588656-06:00","closed_at":"2025-11-20T00:40:41.588656-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-rzw","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.336708-06:00","created_by":"daemon"}]}
{"id":"crystalmath-sro","content_hash":"3be1fef569c4d64086d4c7d8a662874c16a2a24cb58ac026eafe572de3d098e8","title":"Implement SSH Runner for remote execution","description":"Create SSHRunner class in src/runners/ssh.py using asyncssh.\n\nKey features:\n- Connection pooling (reuse SSH connections)\n- Async file transfer via SFTP\n- Real-time stdout/stderr streaming\n- Remote process monitoring\n- Error handling and retry logic\n\nImplementation:\n- Extends BaseRunner abstract interface\n- Uses asyncssh (not paramiko) for async operations\n- Implements _get_connection() for connection pooling\n- Implements _transfer_files() for SFTP uploads\n- Implements run_job() with streaming output\n\nDependencies:\n- pip install asyncssh\n- BaseRunner interface must be defined\n\nTesting:\n- Mock asyncssh connections\n- Test file transfer\n- Test process execution\n- Test error handling\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.2","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:08.062949-06:00","updated_at":"2025-11-21T06:59:41.751892-06:00","closed_at":"2025-11-21T06:59:41.751892-06:00","source_repo":".","labels":["core","phase-2","remote-execution"]}
{"id":"crystalmath-t20","content_hash":"5ff8ed93a81345b6def21185468b34b3f06230f9379ba53eeba07751bab59303","title":"SECURITY: Escape SLURM script generation","description":"slurm_runner.py:189-275 embeds unescaped user fields in SLURM scripts (job_name, partition, env, modules). No validation of crystal binary path.\n\nFix:\n- Escape/quote all user-supplied fields in SBATCH directives\n- Validate job_name, partition names (alphanumeric only)\n- Validate module names and environment variables\n- Verify crystal executable exists and is valid binary\n- Use shlex.quote for all script interpolation\n- Add SLURM injection tests\n\nVulnerable fields:\n- #SBATCH --job-name={job_name}\n- #SBATCH --partition={partition}\n- module load {modules}\n- {env_vars}\n\nImpact: Command injection in HPC batch submission.\n\nFiles: tui/src/runners/slurm_runner.py","status":"open","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:48.316042-06:00","updated_at":"2025-11-21T08:07:48.316042-06:00","source_repo":".","labels":["critical","phase-2","remote-execution","security","slurm"]}
{"id":"crystalmath-wil","content_hash":"0f2832bf76e52958d19fecb0263c9041389361d9b85955a7c31287d5a831cad2","title":"Implement automatic error analysis system","description":"Add intelligent failure analysis that scans output logs for common CRYSTAL23 errors (SCF divergence, memory issues) and provides student-friendly diagnostic hints and solutions.","design":"From V2/CrystalRun:280-308. Create analyze_failure() function in cry-exec.sh. Patterns: 'DIVERGENCE' → SCF hints, 'insufficient memory'/'SIGSEGV' → memory hints. Display with ui_warning and show last 20 lines of log. Call from exec_crystal_run on non-zero exit.","acceptance_criteria":"- Detects SCF divergence\n- Detects memory errors\n- Provides actionable hints\n- Shows log tail (20 lines)\n- Integrates with cry-exec","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-19T23:00:48.95185-06:00","updated_at":"2025-11-19T23:55:18.477878-06:00","closed_at":"2025-11-19T23:55:18.477878-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-wil","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.806109-06:00","created_by":"daemon"}]}
{"id":"crystalmath-wjy","content_hash":"993715ae353675ab466958845d4dc4c3a082b709699b0262f425c09643f08bac","title":"Add strict mode to all bash modules","description":"Only cli/lib/core.sh sets 'set -euo pipefail'. Other modules (cry-parallel.sh:1-15, cry-scratch.sh, cry-stage.sh) rely on caller for error flags.\n\nFix:\n- Add guard header to each module:\n  [[ ${_CRY_MODULE_LOADED:-0} -eq 1 ]] \u0026\u0026 return\n  set -euo pipefail\n  readonly _CRY_MODULE_LOADED=1\n\n- Ensure IFS is set appropriately\n- Add shellcheck directives for module-specific needs\n- Test modules can be sourced directly\n- Document strict mode expectations\n\nImpact: Silent failures when modules sourced directly or from future entrypoints.\n\nAffected modules:\n- cli/lib/cry-parallel.sh\n- cli/lib/cry-scratch.sh\n- cli/lib/cry-stage.sh\n- cli/lib/cry-exec.sh\n- cli/lib/cry-help.sh\n- cli/lib/cry-ui.sh\n\nFiles: cli/lib/*.sh (except core.sh which already has it)","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:52.24898-06:00","updated_at":"2025-11-21T12:15:52.24898-06:00","source_repo":".","labels":["bash","cli","reliability"]}
{"id":"crystalmath-wwa","content_hash":"f7824b0fbb8a73027c9e77281fdc86e2bca223a72fade241772b08db1ba4d0c5","title":"Implement lib/cry-help.sh","description":"Help system module. Function: help_show_main() displays interactive menu. Preserves existing help content from runcrystal:120-224","design":"Extract help system to module. Keep gum choose and gum pager logic. Prepare integration point for cry-docs (line 214-219 logic)","acceptance_criteria":"- help_show_main() displays menu\n- All help topics preserved\n- gum integration works\n- Placeholder for cry-docs integration ready","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.953841-06:00","updated_at":"2025-11-19T20:55:19.451921-06:00","closed_at":"2025-11-19T20:55:19.451921-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.063318-06:00","created_by":"daemon"},{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.571175-06:00","created_by":"daemon"},{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.188014-06:00","created_by":"daemon"}]}
{"id":"crystalmath-x7l","content_hash":"47738ede073dd14d1712e2730414ed15c164fad83c50e06cb13d94d41e759a04","title":"Create Results Summary View","description":"Parse and display structured results in Results tab. Show final energy display, geometry information, key calculation parameters, and error messages if failed.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:30.439808-06:00","updated_at":"2025-11-20T23:26:19.800396-06:00","closed_at":"2025-11-20T23:26:19.800396-06:00","source_repo":".","labels":["mvp","phase-1","results"]}
{"id":"crystalmath-xev","content_hash":"4557f8ea83f849b8ea0634dea5758c47f1b28658d5366d66d665f31dedc9862c","title":"Implement Batch Job Submission UI","description":"Create BatchSubmitScreen in src/tui/screens/batch_submit.py.\n\nFeatures:\n- Multi-select in job list (Shift+Arrow, Space)\n- Batch actions: Submit All, Stop All, Delete All\n- Progress indicator (N/M jobs processed)\n- Automatic delay between submissions\n\nUI components:\n- DataTable with selectable rows\n- Action buttons (Submit, Stop, Delete)\n- Progress bar\n- Status messages\n\nImplementation:\n- Track selected jobs with set\n- Handle keyboard shortcuts\n- Use Textual Worker for async submission\n- Rate limit submissions (2-5 second delay)\n\nSee: tui/docs/PHASE2_DESIGN.md section 2.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:14.084737-06:00","updated_at":"2025-11-21T06:53:25.687449-06:00","closed_at":"2025-11-21T06:53:25.687449-06:00","source_repo":".","labels":["batch","phase-2","ui"]}
{"id":"crystalmath-xjk","content_hash":"408f9550a3b42845ac701f7a0161e108cbbd0920df4a78a6a2d477be9750bb26","title":"Complete Core Job Runner","description":"Implement real CRYSTAL job execution with CRYSTALpytools integration. Replace mock subprocess with actual crystalOMP execution. Parse output files for energy and results. Detect errors and convergence. Store structured results in database.","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2025-11-20T19:20:23.494592-06:00","updated_at":"2025-11-20T21:36:35.173314-06:00","source_repo":".","labels":["core","mvp","phase-1"]}
{"id":"crystalmath-z00","content_hash":"1041775f674bd153fc1e8068747be59c54c474f3fc129fa7649af4e293b81dcc","title":"Write integration tests","description":"End-to-end workflow tests with mocked CRYSTAL23 binaries","design":"From codex: Set CRY_FAKE_BIN=true, create fake crystalOMP/PcrystalOMP that exit 0, verify full workflow: parse args → setup → stage → exec → retrieve → cleanup","acceptance_criteria":"- Smoke test with serial mode\n- Smoke test with parallel mode\n- Test failure handling\n- Test scratch cleanup on error\n- All integration tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.288627-06:00","updated_at":"2025-11-20T23:27:47.04236-06:00","closed_at":"2025-11-20T23:27:47.04236-06:00","source_repo":".","dependencies":[{"issue_id":"crystalmath-z00","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.427689-06:00","created_by":"daemon"}]}
{"id":"crystalmath-z2i","content_hash":"9d46fd1d02161780ad9f9f0a4932fb9958f9f0df56b85eb2e6bd1a3eaf2cba0c","title":"Orchestrator hardcodes /tmp for workflow dirs","description":"orchestrator.py:553-560 hardcodes workflow directories to /tmp/workflow_*, ignoring CRY23_SCRDIR/CRY_SCRATCH_BASE environment variables. Causes orphaned files, clashes on shared hosts, violates configuration guidelines.\n\nFix:\n- Inject scratch base from environment/config\n- Use CRY_SCRATCH_BASE or CRY23_SCRDIR if set\n- Register cleanup handlers for workflow completion/failure\n- Create unique timestamped directories\n- Add configurable retention policy\n\nImpact: Orphaned files in /tmp, directory name clashes on shared systems, violates scratch directory conventions.\n\nBefore:\nwork_dir = Path(f'/tmp/workflow_{workflow_id}_node_{node.node_id}')\n\nAfter:\nscratch_base = Path(os.environ.get('CRY_SCRATCH_BASE', tempfile.gettempdir()))\nwork_dir = scratch_base / f'workflow_{workflow_id}_node_{node.node_id}_{timestamp}'\n# Register cleanup on completion\n\nFiles: tui/src/core/orchestrator.py","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:05.320926-06:00","updated_at":"2025-11-21T12:14:05.320926-06:00","source_repo":".","labels":["configuration","orchestration","phase-2"]}
