{"id":"crystalmath-02y","title":"Queue manager N+1 query problem","description":"queue_manager.py:529-558 scans _jobs dict every tick and calls db.get_job() per entry, creating O(n) queries each second as queue grows.\n\nFix:\n- Cache job status in memory (update on status changes)\n- Fetch all job statuses in single query per cycle\n- Use database triggers/views for status aggregation\n- Add query batching with asyncio.gather\n- Implement incremental status polling\n\nImpact: Unnecessary database load as queue grows, latency spikes on large queues.\n\nOptimization:\n# Instead of: for job in _jobs: status = db.get_job(job.id)\n# Use: statuses = db.get_job_statuses([job.id for job in _jobs])\n\nFiles: tui/src/core/queue_manager.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:20.593681-06:00","updated_at":"2025-11-22T23:47:15.89911-06:00","closed_at":"2025-11-22T23:47:15.89911-06:00","labels":["database","performance","phase-2","queue"],"comments":[{"id":4,"issue_id":"crystalmath-02y","author":"briansquires","text":"Agent 9 implementation: NEEDS_WORK (60% confidence)\n\n✅ COMPLETED:\n- get_job_statuses_batch() method implemented in database.py\n- Status caching infrastructure added to queue_manager.py\n- 13 performance tests showing 8.9-10.6× speedup\n- Batch queries working for main job status checks\n\n❌ REMAINING ISSUE: Dependency checks still use INDIVIDUAL queries (lines 611-620)\n\nPROBLEM: N+1 behavior reintroduced in dependency checking loop:\nfor dep_id in job.dependencies:\n    dep_status = await self.db.get_job_status(dep_id)  # Individual query!\n\nREQUIRED FIX:\ndep_statuses = await self.db.get_job_statuses_batch(job.dependencies)\nall_deps_met = all(status == 'completed' for status in dep_statuses.values())\n\nIMPACT: Performance degradation under load with complex dependency graphs\n\nFiles: tui/src/core/database.py, tui/src/core/queue_manager.py\nCodex review: See CODE_QUALITY_REVIEW.md - Agent 9 section\n","created_at":"2025-11-21T19:04:03Z"}]}
{"id":"crystalmath-0gy","title":"SECURITY: Escape remote commands in SSH Runner","description":"ssh_runner.py:121-183,358-434 interpolates remote commands without shell escaping. Crafted work_dir or scratch_dir names can inject commands.\n\nFix:\n- Use shlex.quote() for all remote path interpolation\n- Validate directory/file names (no special chars)\n- Quote all paths in execution scripts\n- Use parameterized commands where possible\n- Add command injection tests\n\nExamples of vulnerable code:\n- mkdir -p {remote_scratch_dir}\n- cd {work_dir} \u0026\u0026 run...\n- kill -TERM {pid}\n\nImpact: Command injection on remote systems.\n\nFiles: tui/src/runners/ssh_runner.py","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:46.6857-06:00","updated_at":"2025-11-21T14:27:36.674705-06:00","closed_at":"2025-11-21T14:27:36.674705-06:00","labels":["critical","phase-2","remote-execution","security"],"comments":[{"id":1,"issue_id":"crystalmath-0gy","author":"briansquires","text":"Agent 3 implementation: NEEDS_WORK (48% confidence)\n\n✅ COMPLETED: Most command arguments now use shlex.quote(), PID validation added, 35 security tests passing\n\n❌ REMAINING ISSUE: SSH execution script generation (lines 592-629) still has UNQUOTED paths:\n- remote_work_dir\n- remote_crystal_root  \n- input_file\n\nCRITICAL: Command injection still possible via script generation. Tests don't cover this vulnerability.\n\nREQUIRED FIX: Add shlex.quote() to all variables in generated execution script.\n\nFile: tui/src/runners/ssh_runner.py\nCodex review: See CODE_QUALITY_REVIEW.md - Agent 3 section\n","created_at":"2025-11-21T19:03:10Z"}]}
{"id":"crystalmath-168","title":"Implement Auto-Generated Parameter Forms","description":"Create TemplateFormScreen in src/tui/screens/template_form.py.\n\nFeatures:\n- Auto-generate form fields from template metadata\n- Field validation\n- Default value population\n- Generate input preview\n- Create job with rendered input\n\nImplementation:\n- Parse template metadata (parameters, types, defaults)\n- Create Input widgets dynamically\n- Validate on submit\n- Render template with user values\n- Create job with generated input\n\nWidget types:\n- Input for text/numbers\n- Select for enums\n- Checkbox for booleans\n- TextArea for multi-line\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.3","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-20T23:24:20.573275-06:00","updated_at":"2025-11-21T07:02:13.273837-06:00","closed_at":"2025-11-21T07:02:13.273837-06:00","labels":["phase-2","templates","ui"]}
{"id":"crystalmath-1om","title":"SSH runner status detection brittle","description":"ssh_runner.py:271-347 uses grep -i 'error|failed|abort' for status detection. Never surfaces actual exit codes, treats missing output.log as failure.\n\nFix:\n- Capture and return actual process exit codes\n- Use exit code as primary status indicator\n- Add retry/backoff for transient SSH errors\n- Handle missing output files gracefully\n- Improve error message clarity\n- Add robust status detection tests\n\nIssues:\n- Brittle regex-based status detection\n- No access to actual exit codes\n- Transient failures not retried\n- Poor error diagnostics\n\nFiles: tui/src/runners/ssh_runner.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:20.939684-06:00","updated_at":"2025-11-23T14:39:01.925141-06:00","closed_at":"2025-11-23T14:39:01.925141-06:00","labels":["phase-2","reliability","remote-execution"]}
{"id":"crystalmath-22s","title":"Add shellcheck to CI","description":"Run shellcheck on all lib/*.sh and bin/runcrystal. Fix warnings","acceptance_criteria":"- shellcheck passes on all scripts\n- No warnings in lib/ modules\n- Main script clean\n- CI configured if applicable","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.327616-06:00","updated_at":"2025-11-19T21:14:28.518209-06:00","closed_at":"2025-11-19T21:14:28.518209-06:00","dependencies":[{"issue_id":"crystalmath-22s","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.453955-06:00","created_by":"daemon"}]}
{"id":"crystalmath-28a","title":"Implement Template Browser UI","description":"Create TemplateBrowserScreen in src/tui/screens/template_browser.py.\n\nFeatures:\n- List all available templates\n- Preview template content\n- Show parameter descriptions\n- Launch parameter form\n- Search/filter templates\n\nUI components:\n- DataTable for template list\n- TextArea for preview (read-only)\n- Parameter info panel\n- 'Use Template' button\n\nImplementation:\n- Load templates on mount\n- Syntax highlight preview (if possible)\n- Handle template selection\n- Navigate to parameter form\n\nIntegration:\n- Action: 't' key for Template Browser\n- Pass selected template to parameter form\n- Generate input and create job\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:19.433113-06:00","updated_at":"2025-11-21T06:58:59.218752-06:00","closed_at":"2025-11-21T06:58:59.218752-06:00","labels":["phase-2","templates","ui"]}
{"id":"crystalmath-3cv","title":"Implement lib/cry-parallel.sh","description":"Parallelism logic and resource allocation. Function: parallel_setup(nprocs, job_state_ref) populates CRY_JOB array with MODE, EXE_PATH, OMP_NUM_THREADS, MPI_RANKS, THREADS_PER_RANK","design":"From gemini: Use name reference to CRY_JOB array. Calculate threads per rank. Export OMP_NUM_THREADS, I_MPI_PIN_DOMAIN, KMP_AFFINITY, OMP_STACKSIZE=256M. Return 0 on success","acceptance_criteria":"- parallel_setup() correctly calculates resources\n- Env vars exported properly\n- CRY_JOB array populated with all required keys\n- Serial and hybrid modes both work","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.813299-06:00","updated_at":"2025-11-19T20:57:48.155031-06:00","closed_at":"2025-11-19T20:57:48.155031-06:00","dependencies":[{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-a2j","type":"blocks","created_at":"2025-11-19T20:36:49.807568-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.96926-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-rzw","type":"blocks","created_at":"2025-11-19T20:36:50.248531-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.478024-06:00","created_by":"daemon"},{"issue_id":"crystalmath-3cv","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.084005-06:00","created_by":"daemon"}]}
{"id":"crystalmath-3q8","title":"Remove unused dependencies","description":"Heavy dependencies in tui/pyproject.toml are not referenced in code: pymatgen, ase, CRYSTALpytools, toml (verified with ripgrep).\n\nFix:\n- Remove unused dependencies from pyproject.toml\n- Or move to optional extras if planned for future\n- Update installation documentation\n- Run dependency audit for security vulnerabilities\n- Consider upper version bounds to prevent breaking upgrades\n\nImpact: Slower installs, larger attack surface, potential version conflicts, wasted bandwidth.\n\nUnused packages:\n- pymatgen\u003e=2023.0.0\n- ase\u003e=3.22.0\n- CRYSTALpytools\u003e=2023.0.0\n- toml\u003e=0.10.0\n\nFiles: tui/pyproject.toml\n\nNote: If these are needed for future features, document usage or move to [project.optional-dependencies].","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-21T12:15:38.274806-06:00","updated_at":"2025-11-22T23:45:16.660169-06:00","closed_at":"2025-11-22T23:45:16.660169-06:00","labels":["dependencies","deployment","security"],"comments":[{"id":5,"issue_id":"crystalmath-3q8","author":"briansquires","text":"Agent 10 implementation: NEEDS_WORK (55% confidence)\n\n✅ COMPLETED:\n- Core dependencies reduced from 10 to 6 packages\n- Heavy packages (pymatgen, ase, toml) removed from core\n- CRYSTALpytools moved to optional [analysis] extras\n- Core install: ~46MB ✅\n\n❌ ISSUE: Size reduction claims MISLEADING\n\nREALITY CHECK:\n- Core only (no extras): ~46MB ✅ ACCURATE\n- With [analysis] extras: ~547MB ❌ SAME AS BEFORE\n\nPROBLEM: Heavy packages just moved to extras, not removed. Users who need CRYSTALpytools get no size benefit.\n\nRECOMMENDATION:\n1. Either remove heavy extras entirely (if not needed)\n2. OR clarify documentation: \"Core: 46MB, Full with analysis: 547MB\"\n\nCurrent claim of \"91% reduction\" is technically correct for core-only but misleading for typical users.\n\nFile: tui/pyproject.toml\nImpact: Documentation accuracy, user expectations\nCodex review: See CODE_QUALITY_REVIEW.md - Agent 10 section\n","created_at":"2025-11-21T19:04:23Z"},{"id":6,"issue_id":"crystalmath-3q8","author":"briansquires","text":"✅ VERIFIED COMPLETE\n\nAll unused dependencies already removed/reorganized:\n- pymatgen, ase, CRYSTALpytools → moved to optional [analysis] extras\n- toml → completely removed (no imports found in src/)\n\n**Current state:**\n- Core dependencies: 6 packages (~46MB) - ALL actively used\n- Optional [analysis]: 3 packages (~500MB) - for future features\n\n**Verification:**\n```bash\n# All 6 core deps confirmed in use:\n✅ textual - 50+ imports in tui/\n✅ rich - 15+ imports in widgets/\n✅ jinja2 - 2 files (templates.py, orchestrator.py)\n✅ pyyaml - 1 file (templates.py)\n✅ asyncssh - 2 files (connection_manager.py, ssh_runner.py)\n✅ keyring - 1 file (connection_manager.py)\n\n# No unused deps found:\n✅ pymatgen - 0 imports\n✅ ase - 0 imports\n✅ CRYSTALpytools - 0 imports (except fallback handler)\n✅ toml - 0 imports\n```\n\n**Documentation:** docs/DEPENDENCY_CLEANUP_COMPLETED.md\n\nIssue can be closed - 91% size reduction achieved for default installs.","created_at":"2025-11-23T05:45:10Z"}]}
{"id":"crystalmath-4x0","title":"Row Rendering Contract","description":"Define single canonical formatter for job rows so DB/model changes don't ripple into UI. Centralize row formatting logic to ensure consistency and reduce coupling between database schema and UI presentation.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:31:15.442526-06:00","updated_at":"2025-12-17T14:31:15.442526-06:00"}
{"id":"crystalmath-4x8","title":"SECURITY: Sandbox Jinja2 template engine","description":"templates.py:24-212 uses unsandboxed Jinja Environment with autoescape=False. User-supplied templates can execute arbitrary code, read files, and exfiltrate data.\n\nFix:\n- Use SandboxedEnvironment instead of Environment\n- Enable autoescape=True\n- Disable enable_async\n- Restrict available filters and functions\n- Validate template paths are under template_dir\n- Add template security tests\n\nImpact: Template injection leading to code execution and data exfiltration.\n\nFiles: tui/src/core/templates.py","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:45.228936-06:00","updated_at":"2025-11-21T13:02:36.608949-06:00","closed_at":"2025-11-21T13:02:36.608949-06:00","labels":["critical","phase-2","security","templates"]}
{"id":"crystalmath-4y8","title":"MEDIUM: Remove or integrate dead code in backend.py","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T19:09:13.379287-06:00","updated_at":"2025-12-22T19:09:13.379287-06:00"}
{"id":"crystalmath-537","title":"Add --explain/--dry-run educational mode","description":"Implement dry-run mode that shows hardware detection, parallel strategy, Intel optimizations, file staging plan, and execution command WITHOUT running calculation. Educational feature for students learning HPC.","design":"From V2/CrystalRun:136-225. Parse flag before input validation. Build explanation using cry-ui cards showing: 1) Hardware (cores, ranks), 2) Parallel strategy (thread calculation), 3) Intel opts (pinning, affinity, stack), 4) File staging (scratch dir, files to copy), 5) Execution command. Exit after display.","acceptance_criteria":"- --explain flag recognized\n- Shows 5-section breakdown\n- Uses ui_card for formatting\n- Exits without running calculation\n- Matches V2 educational quality","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-19T23:00:47.743062-06:00","updated_at":"2025-11-19T23:55:11.808314-06:00","closed_at":"2025-11-19T23:55:11.808314-06:00","dependencies":[{"issue_id":"crystalmath-537","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.778488-06:00","created_by":"daemon"}]}
{"id":"crystalmath-53w","title":"Environment detection breaks when packaged","description":"environment.py:53-67 auto-detects CRY23_ROOT via Path(__file__).parents[4], which breaks when installed via pip or if repo layout changes.\n\nFix:\n- Prefer CRY23_ROOT environment variable\n- Accept bashrc_path parameter explicitly\n- Raise actionable error if CRYSTAL23 not found\n- Document installation requirements\n- Add validation that cry23.bashrc exists\n\nImpact: Production pip installs won't find cry23.bashrc, causing startup failures.\n\nRecommendation:\n1. Check CRY23_ROOT env var first\n2. Fall back to explicit bashrc_path parameter\n3. Only use __file__ traversal as last resort\n4. Add clear error message with setup instructions\n\nFiles: tui/src/core/environment.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:13.624967-06:00","updated_at":"2025-11-21T13:02:53.5465-06:00","closed_at":"2025-11-21T13:02:53.5465-06:00","labels":["deployment","environment","phase-1"]}
{"id":"crystalmath-5ab","title":"Add Comprehensive Unit Tests","description":"Test suite for core functionality. Include database CRUD operations, job state transitions, CRYSTALpytools integration, and mock runner tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T19:20:31.80782-06:00","updated_at":"2025-11-20T23:27:59.227307-06:00","closed_at":"2025-11-20T23:27:59.227307-06:00","labels":["mvp","phase-1","testing"]}
{"id":"crystalmath-5nx","title":"Move runcrystal to bin/runcrystal","description":"Relocate current monolithic script as reference, create new modular version in bin/","acceptance_criteria":"- Old script saved as runcrystal.monolithic\n- New script in bin/runcrystal\n- bin/runcrystal executable\n- PATH handling correct for lib/ discovery","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.024223-06:00","updated_at":"2025-11-19T21:06:33.40139-06:00","closed_at":"2025-11-19T21:06:33.40139-06:00","dependencies":[{"issue_id":"crystalmath-5nx","depends_on_id":"crystalmath-22s","type":"blocks","created_at":"2025-11-19T20:36:50.409227-06:00","created_by":"daemon"},{"issue_id":"crystalmath-5nx","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.234639-06:00","created_by":"daemon"}]}
{"id":"crystalmath-5w6","title":"Centralize status string constants","description":"Status values are scattered as raw strings across database.py:135-213, queue_manager.py:533-569, and tests ('PENDING', 'QUEUED', 'RUNNING', etc.).\n\nFix:\n- Create central status constants module or enum\n- Define all valid job/workflow statuses\n- Add status transition validators\n- Update DB constraints to match\n- Replace all string literals with constants\n- Add status lifecycle tests\n\nImpact: Typo-prone code, hard to change lifecycle, inconsistent status handling across modules.\n\nExample:\n# Create src/core/status.py\nfrom enum import Enum\n\nclass JobStatus(str, Enum):\n    PENDING = 'pending'\n    QUEUED = 'queued'\n    RUNNING = 'running'\n    COMPLETED = 'completed'\n    FAILED = 'failed'\n    CANCELLED = 'cancelled'\n\nFiles:\n- tui/src/core/database.py\n- tui/src/core/queue_manager.py\n- tui/src/core/orchestrator.py\n- All test files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:24.137746-06:00","updated_at":"2025-11-23T15:00:02.334231-06:00","closed_at":"2025-11-23T15:00:02.334231-06:00","labels":["code-quality","maintainability","phase-2"]}
{"id":"crystalmath-6fm","title":"Job List Scale Test (1000+ rows) + Perf Budget","description":"Create performance test to verify TUI handles 1000+ jobs without UI lag. Establish performance budget metrics for refresh operations. Ties to epic acceptance criteria.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:31:03.789027-06:00","updated_at":"2025-12-17T14:31:03.789027-06:00"}
{"id":"crystalmath-6fy","title":"Migrate to AiiDA CRYSTAL parsers - use aiida-crystal17 plugin parsers","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T18:52:15.148703-06:00","updated_at":"2025-12-22T18:52:15.148703-06:00"}
{"id":"crystalmath-6o9","title":"Update CLAUDE.md for refactored architecture","description":"Update CLAUDE.md with new structure, module descriptions, testing instructions","acceptance_criteria":"- CLAUDE.md reflects new architecture\n- Testing instructions included\n- Module responsibilities documented\n- Future maintainer can understand structure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.398241-06:00","updated_at":"2025-11-19T21:09:14.22883-06:00","closed_at":"2025-11-19T21:09:14.22883-06:00","dependencies":[{"issue_id":"crystalmath-6o9","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.504523-06:00","created_by":"daemon"}]}
{"id":"crystalmath-6sp","title":"Implement lib/cry-config.sh","description":"Central configuration module with cry_config_init(), path exports, environment checks. Handles CRY23_ROOT, BIN_DIR, SCRATCH_BASE. Supports env var overrides","design":"From codex: Use : ${VAR:=default} pattern. Export CRY_VERSION, CRY_ARCH, CRY_BIN_DIR. Implement cry_config_get() helper. Support optional cry.conf file","acceptance_criteria":"- cry_config_init() function works\n- All path variables exported correctly\n- Env var overrides functional\n- Module sources without errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.665915-06:00","updated_at":"2025-11-19T20:50:45.304565-06:00","closed_at":"2025-11-19T20:50:45.304565-06:00","dependencies":[{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.551905-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.620586-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-3cv","type":"blocks","created_at":"2025-11-19T20:36:49.669549-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-hyl","type":"blocks","created_at":"2025-11-19T20:36:49.715592-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-ib2","type":"blocks","created_at":"2025-11-19T20:36:49.76152-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.877184-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-nim","type":"blocks","created_at":"2025-11-19T20:36:50.155165-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.431332-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6sp","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:06.985439-06:00","created_by":"daemon"}]}
{"id":"crystalmath-6vn","title":"Refactor main bin/runcrystal script","description":"Transform runcrystal into thin orchestrator \u003c100 lines. Implement main() function with module loading, argument parsing, pipeline execution","design":"From gemini: Use trap 'scratch_cleanup' EXIT. Declare -A CRY_JOB for state. Load modules in order: config, logging, core, ui, help, parallel, scratch, stage, exec. Call functions in pipeline. From codex: Implement cry_workflow_entry for orchestration","acceptance_criteria":"- Main script \u003c100 lines\n- All modules loaded correctly\n- trap-based cleanup works\n- Preserves all original functionality\n- Error handling robust","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.989123-06:00","updated_at":"2025-11-20T23:22:37.246987-06:00","closed_at":"2025-11-20T23:22:37.246987-06:00","dependencies":[{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-5nx","type":"blocks","created_at":"2025-11-19T20:36:50.086025-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-z00","type":"blocks","created_at":"2025-11-19T20:36:50.386766-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-6o9","type":"blocks","created_at":"2025-11-19T20:36:50.594694-06:00","created_by":"daemon"},{"issue_id":"crystalmath-6vn","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.211255-06:00","created_by":"daemon"}]}
{"id":"crystalmath-75z","title":"Configure SQLite for concurrent access","description":"database.py:86-96 opens SQLite with defaults, no WAL/busy_timeout/journal_mode tuning. Background scheduler + UI threads will hit 'database is locked' errors and slow commits.\n\nFix:\n- Set PRAGMA journal_mode=WAL on init\n- Set PRAGMA busy_timeout=5000 (5 seconds)\n- Set PRAGMA synchronous=NORMAL\n- Wrap write operations in 'with self.conn:' context managers\n- Add connection pooling for multiple readers\n\nImpact: Prevents 'database is locked' errors under concurrent access from UI and scheduler.\n\nBefore:\nself.conn = sqlite3.connect(str(db_path), check_same_thread=False)\n\nAfter:\nself.conn = sqlite3.connect(str(db_path), check_same_thread=False)\nself.conn.execute('PRAGMA journal_mode=WAL')\nself.conn.execute('PRAGMA busy_timeout=5000')\nself.conn.execute('PRAGMA synchronous=NORMAL')\n\nFiles: tui/src/core/database.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:13:49.358039-06:00","updated_at":"2025-11-22T23:47:15.898416-06:00","closed_at":"2025-11-22T23:47:15.898416-06:00","labels":["concurrency","database","performance","phase-2"],"comments":[{"id":3,"issue_id":"crystalmath-75z","author":"briansquires","text":"Agent 6 implementation: FAILED (20% confidence)\n\n❌ STATUS: Task NOT completed due to API Error 500\n❌ No code changes delivered\n❌ No tests written\n\nCRITICAL: SQLite still in default mode (no WAL, no busy_timeout)\n\nIMPACT: Production deployment BLOCKED\n- Multi-user environments will experience \"database is locked\" errors\n- Queue manager + orchestrator + TUI concurrent access will fail\n- High risk under concurrent load\n\nREQUIRED: Retry agent task immediately\n\nNeeded changes:\n- PRAGMA journal_mode=WAL\n- PRAGMA busy_timeout=5000 (or higher)\n- Connection pooling configuration\n- Concurrency tests\n\nFile: tui/src/core/database.py\nPriority: P0 - BLOCKING\nCodex review: See CODE_QUALITY_REVIEW.md - Agent 6 section\n","created_at":"2025-11-21T19:03:45Z"}]}
{"id":"crystalmath-7cp","title":"Migrate SLURM Script Generation to Templates","description":"Replace the hardcoded string concatenation in SLURMRunner._generate_slurm_script with secure Jinja2 templates managed by TemplateManager. This improves maintainability and leverages existing sandboxing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T13:29:51.159145-06:00","updated_at":"2025-12-17T18:46:29.779589-06:00","closed_at":"2025-12-17T18:46:29.779589-06:00"}
{"id":"crystalmath-7dl","title":"Refactor TUI Job List to Incremental Updates","description":"The current _refresh_job_list clears and repopulates the entire DataTable. Implement a diffing mechanism to only add/update changed rows. Performance degrades with 100+ jobs and UI flickers on refresh.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-17T13:29:28.352678-06:00","updated_at":"2025-12-17T19:41:01.772029Z","closed_at":"2025-12-17T19:41:01.772029Z"}
{"id":"crystalmath-7e1","title":"Write module documentation","description":"Document each lib/ module: purpose, functions, parameters, return codes, usage examples","acceptance_criteria":"- Each module has header documentation\n- Function signatures documented\n- Examples provided\n- References to design decisions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.363784-06:00","updated_at":"2025-11-20T23:24:34.259681-06:00","closed_at":"2025-11-20T23:24:34.259681-06:00","dependencies":[{"issue_id":"crystalmath-7e1","depends_on_id":"crystalmath-ps0","type":"blocks","created_at":"2025-11-19T20:36:50.622011-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7e1","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.478814-06:00","created_by":"daemon"}]}
{"id":"crystalmath-7jf","title":"Set up testing framework (bats)","description":"Install bats-core, create tests/ directory structure, write test harness and mock utilities","design":"From codex: Mock external commands via CRY_CMD_MPIRUN, CRY_CMD_GUM vars. Create tests/mocks/ for fake binaries. Set up tests/helpers.bash for common test functions","acceptance_criteria":"- bats-core installed\n- tests/ directory structure created\n- Mock framework implemented\n- Helper functions available","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.061984-06:00","updated_at":"2025-11-19T20:50:46.283658-06:00","closed_at":"2025-11-19T20:50:46.283658-06:00","dependencies":[{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-nim","type":"blocks","created_at":"2025-11-19T20:36:50.132295-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-pq3","type":"blocks","created_at":"2025-11-19T20:36:50.178562-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-rzw","type":"blocks","created_at":"2025-11-19T20:36:50.225654-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-pc3","type":"blocks","created_at":"2025-11-19T20:36:50.271326-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-dmt","type":"blocks","created_at":"2025-11-19T20:36:50.317159-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-z00","type":"blocks","created_at":"2025-11-19T20:36:50.363563-06:00","created_by":"daemon"},{"issue_id":"crystalmath-7jf","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.258432-06:00","created_by":"daemon"}]}
{"id":"crystalmath-7o7","title":"Implement Connection Manager","description":"Create ConnectionManager class in src/core/connections.py.\n\nFeatures:\n- Register multiple clusters\n- Get runner instance for cluster\n- List available clusters\n- Validate cluster connectivity\n- Health monitoring\n\nImplementation:\n\n\nIntegration:\n- Load clusters from database on startup\n- Expose to TUI app\n- Cache runner instances\n\nTesting:\n- Mock cluster configuration\n- Test connection pooling\n- Test error handling\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.4","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:13.144331-06:00","updated_at":"2025-11-21T06:55:17.806431-06:00","closed_at":"2025-11-21T06:55:17.806431-06:00","labels":["core","phase-2","remote-execution"]}
{"id":"crystalmath-7ta","title":"CRITICAL: Wire app_enhanced.py to QueueManager instead of direct LocalRunner","description":"","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-22T19:08:27.235199-06:00","updated_at":"2025-12-22T19:08:27.235199-06:00"}
{"id":"crystalmath-7yd","title":"DFT-Agnostic TUI Architecture","description":"Transform the TUI from a CRYSTAL23-specific tool into a DFT-agnostic framework.\n\n## Goal\nCreate abstraction layer supporting CRYSTAL23 (fully implemented), Quantum Espresso, and VASP (stubs for future).\n\n## Scope\n- **TUI only** - CLI remains CRYSTAL23-specific\n- **Architecture first** - then existing Phase 1 issues fit naturally\n\n## Phases\n1. Phase 0: Architecture Foundation (4-6h)\n2. Phase 1: CRYSTAL23 Implementation (4-6h)\n3. Phase 2: Refactor Runners (8-12h)\n4. Phase 3: Database \u0026 UI Updates (4-6h)\n5. Phase 4: QE/VASP Stubs (2-4h)\n\n## Key Deliverables\n- New module: tui/src/core/codes/\n- DFTCodeConfig dataclass with file mappings, executables, parsers\n- OutputParser ABC with registry\n- Database migration: add dft_code column\n\n## Plan Reference\n~/.claude/plans/fluttering-beaming-lecun.md","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-10T19:13:11.536436-06:00","updated_at":"2025-12-11T19:44:41.099073-06:00","closed_at":"2025-12-11T19:44:41.099073-06:00","labels":["architecture","dft-agnostic","tui"]}
{"id":"crystalmath-7yd.1","title":"Phase 0: Architecture Foundation","description":"Create the DFT code abstraction layer.\n\n## Tasks\n1. Create tui/src/core/codes/ module structure\n2. Define DFTCode enum and DFTCodeConfig dataclass\n3. Create OutputParser ABC in codes/parsers/base.py\n4. Create DFT_CODE_REGISTRY for code lookup\n\n## Files to Create\n- tui/src/core/codes/__init__.py\n- tui/src/core/codes/base.py\n- tui/src/core/codes/registry.py\n- tui/src/core/codes/parsers/__init__.py\n- tui/src/core/codes/parsers/base.py\n\n## DFTCodeConfig Interface\n```python\n@dataclass\nclass DFTCodeConfig:\n    name: str                           # 'crystal', 'qe', 'vasp'\n    display_name: str                   # 'CRYSTAL23', 'Quantum Espresso', 'VASP'\n    input_extensions: List[str]         # ['.d12'], ['.in'], []\n    output_extension: str               # '.out', '.out', 'OUTCAR'\n    auxiliary_inputs: Dict[str, str]    # {'.gui': 'fort.34', ...}\n    auxiliary_outputs: Dict[str, str]   # {'fort.9': '.f9', ...}\n    serial_executable: str              # 'crystalOMP', 'pw.x', 'vasp_std'\n    parallel_executable: str            # 'PcrystalOMP', 'pw.x', 'vasp_std'\n    invocation_style: str               # 'stdin', 'flag', 'cwd'\n    root_env_var: str                   # 'CRY23_ROOT', 'QE_ROOT', 'VASP_ROOT'\n    bashrc_pattern: str                 # 'cry23.bashrc', 'qe_env.sh', None\n    energy_unit: str                    # 'Hartree', 'Ry', 'eV'\n    convergence_patterns: List[str]     \n    error_patterns: List[str]           \n```","status":"closed","priority":0,"issue_type":"task","estimated_minutes":300,"created_at":"2025-12-10T19:13:41.234636-06:00","updated_at":"2025-12-10T19:18:03.355008-06:00","closed_at":"2025-12-10T19:18:03.355008-06:00","labels":["architecture","phase-0"],"dependencies":[{"issue_id":"crystalmath-7yd.1","depends_on_id":"crystalmath-7yd","type":"parent-child","created_at":"2025-12-10T19:13:41.235759-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-7yd.2","title":"Phase 1: CRYSTAL23 Implementation","description":"Extract current hardcoded CRYSTAL values into the new abstraction.\n\n## Tasks\n1. Create CrystalCodeConfig with all current hardcoded values\n2. Create CrystalOutputParser wrapping CRYSTALpytools\n3. Register CRYSTAL in DFT_CODE_REGISTRY\n4. Add unit tests for CRYSTAL code config\n\n## Files to Create\n- tui/src/core/codes/crystal.py\n- tui/src/core/codes/parsers/crystal.py\n- tui/tests/test_codes_crystal.py\n\n## Values to Extract\nFrom exploration findings:\n- Input: .d12, auxiliary (.gui, .f9, .hessopt, .born)\n- Output: .out, fort.9, fort.98, HESSOPT.DAT, OPTINFO.DAT\n- Executables: crystalOMP (serial), PcrystalOMP (parallel)\n- Invocation: stdin redirection (exe \u003c input \u003e output)\n- Energy unit: Hartree\n- Environment: CRY23_ROOT, CRY23_EXEDIR, cry23.bashrc\n- Convergence patterns: CONVERGENCE, SCF ENDED\n- Error patterns: DIVERGENCE, SCF NOT CONVERGED","status":"closed","priority":0,"issue_type":"task","estimated_minutes":300,"created_at":"2025-12-10T19:13:47.489894-06:00","updated_at":"2025-12-10T19:23:09.584059-06:00","closed_at":"2025-12-10T19:23:09.584059-06:00","labels":["architecture","crystal","phase-1"],"dependencies":[{"issue_id":"crystalmath-7yd.2","depends_on_id":"crystalmath-7yd","type":"parent-child","created_at":"2025-12-10T19:13:47.490648-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-7yd.2","depends_on_id":"crystalmath-7yd.1","type":"blocks","created_at":"2025-12-10T19:14:23.475939-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-7yd.3","title":"Phase 2: Refactor Runners","description":"Update runners to use DFTCodeConfig instead of hardcoded values.\n\n## Tasks\n1. Add dft_code field to RunnerConfig in base.py\n2. Refactor LocalRunner._execute() to use code config:\n   - Input file discovery (.d12 → config.input_extensions)\n   - Executable selection (crystalOMP → config.serial_executable)\n   - Command building (stdin vs flag vs cwd)\n3. Refactor LocalRunner._parse_results() to use parser registry\n4. Refactor SSHRunner file patterns and execution script\n5. Refactor SLURMRunner script generation\n6. Update all tests\n\n## Files to Modify\n- tui/src/runners/base.py\n- tui/src/runners/local.py\n- tui/src/runners/ssh_runner.py\n- tui/src/runners/slurm_runner.py\n\n## Key Changes\n- Replace hardcoded .d12 with config.input_extensions\n- Replace hardcoded crystalOMP with config.serial_executable\n- Replace hardcoded cry23.bashrc with config.bashrc_pattern\n- Use parser registry instead of direct CRYSTALpytools calls","status":"closed","priority":0,"issue_type":"task","estimated_minutes":600,"created_at":"2025-12-10T19:13:54.83337-06:00","updated_at":"2025-12-11T19:44:12.645698-06:00","closed_at":"2025-12-11T19:44:12.645698-06:00","labels":["architecture","phase-2","runners"],"dependencies":[{"issue_id":"crystalmath-7yd.3","depends_on_id":"crystalmath-7yd","type":"parent-child","created_at":"2025-12-10T19:13:54.834198-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-7yd.3","depends_on_id":"crystalmath-7yd.2","type":"blocks","created_at":"2025-12-10T19:14:28.6506-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-7yd.4","title":"Phase 3: Database \u0026 UI Updates","description":"Add DFT code awareness to database and UI.\n\n## Tasks\n1. Add dft_code column to jobs table (migration)\n2. Update Job dataclass with dft_code field\n3. Add DFT code selector to NewJobScreen\n4. Update ResultsSummary to use parser registry\n5. Update environment.py to support multi-code env loading\n\n## Files to Modify\n- tui/src/core/database.py\n- tui/src/tui/screens/new_job.py\n- tui/src/tui/widgets/results_summary.py\n- tui/src/core/environment.py\n\n## Database Migration\n```sql\nALTER TABLE jobs ADD COLUMN dft_code TEXT DEFAULT 'crystal';\nALTER TABLE jobs ADD COLUMN energy_unit TEXT DEFAULT 'Hartree';\nCREATE INDEX idx_jobs_dft_code ON jobs(dft_code);\n```","status":"closed","priority":0,"issue_type":"task","estimated_minutes":300,"created_at":"2025-12-10T19:14:03.139273-06:00","updated_at":"2025-12-11T19:44:24.856392-06:00","closed_at":"2025-12-11T19:44:24.856392-06:00","labels":["architecture","database","phase-3","ui"],"dependencies":[{"issue_id":"crystalmath-7yd.4","depends_on_id":"crystalmath-7yd","type":"parent-child","created_at":"2025-12-10T19:14:03.140055-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-7yd.4","depends_on_id":"crystalmath-7yd.3","type":"blocks","created_at":"2025-12-10T19:14:33.791216-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-7yd.5","title":"Phase 4: QE/VASP Stubs","description":"Create placeholder implementations for future work.\n\n## Tasks\n1. Create QuantumEspressoCodeConfig stub\n2. Create VASPCodeConfig stub\n3. Create stub parsers that raise NotImplementedError\n4. Register in DFT_CODE_REGISTRY\n\n## Files to Create\n- tui/src/core/codes/quantum_espresso.py\n- tui/src/core/codes/vasp.py\n- tui/src/core/codes/parsers/qe.py\n- tui/src/core/codes/parsers/vasp.py\n\n## QE Config (stub)\n- Input: .in\n- Output: .out\n- Executables: pw.x (same for serial/parallel)\n- Invocation: flag (-in input.in)\n- Energy unit: Rydberg\n\n## VASP Config (stub)\n- Input: INCAR, POSCAR, KPOINTS, POTCAR (multi-file)\n- Output: OUTCAR\n- Executables: vasp_std (same for serial/parallel)\n- Invocation: cwd (reads files from working directory)\n- Energy unit: eV","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T19:14:09.910508-06:00","updated_at":"2025-12-11T19:44:29.98507-06:00","closed_at":"2025-12-11T19:44:29.98507-06:00","labels":["architecture","phase-4","qe","vasp"],"dependencies":[{"issue_id":"crystalmath-7yd.5","depends_on_id":"crystalmath-7yd","type":"parent-child","created_at":"2025-12-10T19:14:09.911177-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-7yd.5","depends_on_id":"crystalmath-7yd.2","type":"blocks","created_at":"2025-12-10T19:14:38.923697-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-8bp","title":"Implement Workflow Orchestrator","description":"Create WorkflowOrchestrator class in src/core/orchestrator.py.\n\nFeatures:\n- Execute multi-step workflows\n- Monitor step completion\n- Pass data between steps\n- Handle failures and retries\n- Conditional execution\n\nImplementation:\n\n\nKey logic:\n- Loop: get ready steps → submit → wait → check completion\n- Parse output from completed steps\n- Use parsed data as input for dependent steps\n- Update workflow status in database\n\nDatabase:\n- workflows table\n- workflow_jobs table (links jobs to workflows)\n\nSee: tui/docs/PHASE2_DESIGN.md section 3.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:17.665121-06:00","updated_at":"2025-11-21T06:58:40.370695-06:00","closed_at":"2025-11-21T06:58:40.370695-06:00","labels":["orchestration","phase-2","workflow"]}
{"id":"crystalmath-8gv","title":"Implement Workflow DAG System","description":"Create workflow DAG system in src/core/workflow.py.\n\nClasses:\n- WorkflowStep: Single calculation step\n- Workflow: Collection of steps with dependencies\n- WorkflowOrchestrator: Executes workflows\n\nFeatures:\n- DAG representation (steps + dependencies)\n- Dependency resolution\n- Parallel step execution\n- Error handling and recovery\n- Progress tracking\n\nImplementation:\n\n\nTesting:\n- Test dependency resolution\n- Test parallel execution\n- Test error propagation\n\nSee: tui/docs/PHASE2_DESIGN.md section 3.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:16.826449-06:00","updated_at":"2025-11-21T06:59:03.173954-06:00","closed_at":"2025-11-21T06:59:03.173954-06:00","labels":["core","phase-2","workflow"]}
{"id":"crystalmath-8so","title":"Improve observability in background loops","description":"Orchestrator uses print() and silent 'except Exception' in background monitor (orchestrator.py:694-714), losing stack traces. QueueManager logging defaults to WARNING level.\n\nFix:\n- Replace print() with module-level logger\n- Add structured logging with context (job_id, workflow_id)\n- Configure logging in entrypoint (level, format, handlers)\n- Bubble exceptions to handler instead of swallowing\n- Add log rotation and retention policy\n- Surface errors via Textual notifications\n\nImpact: Difficult incident triage, lost stack traces, poor debugging experience.\n\nExample:\n# Replace:\ntry:\n    ...\nexcept Exception as e:\n    print(f'Error: {e}')\n\n# With:\nlogger = logging.getLogger(__name__)\ntry:\n    ...\nexcept Exception:\n    logger.exception('Workflow monitor error', extra={'workflow_id': wf_id})\n    raise\n\nFiles:\n- tui/src/core/orchestrator.py\n- tui/src/core/queue_manager.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:30.779865-06:00","updated_at":"2025-11-23T14:59:55.837371-06:00","closed_at":"2025-11-23T14:59:55.837371-06:00","labels":["logging","observability","phase-2"]}
{"id":"crystalmath-9kt","title":"SECURITY: Enable SSH host key verification","description":"connection_manager.py:84-137 uses known_hosts=None, disabling host key verification. This exposes all remote execution to MITM attacks.\n\nFix:\n- Remove known_hosts=None parameter\n- Add strict host key checking config option\n- Support known_hosts file path configuration\n- Add host key fingerprint verification\n- Document host key setup process\n\nImpact: All SSH and SLURM runners vulnerable to man-in-the-middle attacks.\n\nFiles: tui/src/core/connection_manager.py","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:43.789762-06:00","updated_at":"2025-11-21T13:02:18.615751-06:00","closed_at":"2025-11-21T13:02:18.615751-06:00","labels":["critical","phase-2","remote-execution","security"]}
{"id":"crystalmath-a2j","title":"Implement lib/cry-exec.sh","description":"Calculation execution module. Function: exec_run(job_state_ref) constructs and executes crystal/mpirun command, handles gum spin wrapper, returns exit code","design":"From gemini: Read CRY_JOB array to build command. Execute in scratch directory. Wrap with gum spin if available. Return actual exit code for status reporting","acceptance_criteria":"- exec_run() builds correct commands\n- Serial mode uses crystalOMP\n- Parallel mode uses mpirun + PcrystalOMP\n- Exit code properly returned\n- gum spin integration works","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.919546-06:00","updated_at":"2025-11-19T20:56:48.771185-06:00","closed_at":"2025-11-19T20:56:48.771185-06:00","dependencies":[{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.041441-06:00","created_by":"daemon"},{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.548204-06:00","created_by":"daemon"},{"issue_id":"crystalmath-a2j","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.163205-06:00","created_by":"daemon"}]}
{"id":"crystalmath-a9n","title":"Implement SLURM Runner for batch submission","description":"Create SLURMRunner class in src/runners/slurm.py for SLURM integration.\n\nKey features:\n- Dynamic SLURM script generation\n- Job submission via sbatch\n- Non-blocking status polling with squeue\n- Job array support for parameter sweeps\n- Automatic result retrieval on completion\n\nImplementation:\n- Extends BaseRunner interface\n- Uses SSHRunner internally for SSH operations\n- Implements _generate_slurm_script() for script generation\n- Implements _check_status() for job monitoring\n- Polls every 30 seconds (configurable)\n\nTesting:\n- Mock SSH commands (sbatch, squeue)\n- Test script generation\n- Test status parsing\n- Test job array submission\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.3","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:08.923256-06:00","updated_at":"2025-11-21T06:55:36.923725-06:00","closed_at":"2025-11-21T06:55:36.923725-06:00","labels":["phase-2","remote-execution","slurm"]}
{"id":"crystalmath-ae6","title":"[epic] Runner Correctness \u0026 Data Safety Sprint","description":"Critical sprint to fix data safety and runner correctness issues identified in Codex deep code review. Priority: 1) Orchestrator cleanup safety 2) LocalRunner correctness 3) BaseRunner contract completion 4) Runner cleanup + concurrency 5) Custom output parsers. Transferred P1 issues from crystalmath-d6t.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T09:29:40.188636-06:00","updated_at":"2025-12-22T19:07:43.127323-06:00","closed_at":"2025-12-22T19:07:43.127323-06:00","labels":["critical","phase-2","runners","sprint"]}
{"id":"crystalmath-ae6.1","title":"[task] CRITICAL: Fix orchestrator atexit cleanup data loss","description":"orchestrator.py:349 _cleanup_work_dirs unconditionally shutil.rmtree's all scratch dirs at process exit. If workflow still running or results not retrieved, inputs/outputs can be deleted. Fix: only cleanup dirs whose jobs are in terminal state, or move cleanup behind explicit user action/config flag.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T09:30:38.91687-06:00","updated_at":"2025-12-22T18:04:46.349174-06:00","closed_at":"2025-12-22T18:04:46.349174-06:00","labels":["critical","data-loss","orchestrator"],"dependencies":[{"issue_id":"crystalmath-ae6.1","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:30:38.91757-06:00","created_by":"briansquires"}],"comments":[{"id":10,"issue_id":"crystalmath-ae6.1","author":"briansquires","text":"Fixed: Changed _work_dirs from Set to Dict mapping work_dir -\u003e workflow_id. Updated _cleanup_work_dirs to only clean directories for workflows in terminal state (COMPLETED, FAILED, CANCELLED). Running workflow directories are now preserved.","created_at":"2025-12-22T15:49:11Z"}]}
{"id":"crystalmath-ae6.10","title":"[task] Update project documentation (CLAUDE.md, AGENTS.md)","description":"BLOCKED by cross-validation task. After validation passes: 1) Update CLAUDE.md with architecture/workflow changes 2) Update AGENTS.md if agent patterns changed 3) Only close after docs updated and verified. Per hookify epic workflow.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:33:32.456198-06:00","updated_at":"2025-12-22T18:04:46.354874-06:00","closed_at":"2025-12-22T18:04:46.354874-06:00","labels":["blocked","documentation"],"dependencies":[{"issue_id":"crystalmath-ae6.10","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:33:32.456931-06:00","created_by":"briansquires"}],"comments":[{"id":22,"issue_id":"crystalmath-ae6.10","author":"briansquires","text":"Updated CLAUDE.md with ae6 sprint changes (runner safety section, orchestrator features, project status). Updated GEMINI.md to reflect Phase 2 complete status and remove outdated security warnings. AGENTS.md unchanged (no workflow pattern changes).","created_at":"2025-12-22T16:19:04Z"}]}
{"id":"crystalmath-ae6.11","title":"[bug] CRITICAL: LocalRunner _last_result race condition still exists","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:09:11.948749-06:00","updated_at":"2025-12-22T18:04:46.355234-06:00","closed_at":"2025-12-22T18:04:46.355234-06:00","labels":["P0","bug","critical"],"dependencies":[{"issue_id":"crystalmath-ae6.11","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T10:09:11.950014-06:00","created_by":"briansquires"}],"comments":[{"id":18,"issue_id":"crystalmath-ae6.11","author":"briansquires","text":"Fixed race condition by yielding JobResult as final item from run_job() and capturing it directly in _run_job_task() instead of reading shared _last_result. All 27 LocalRunner tests pass.","created_at":"2025-12-22T16:11:27Z"}]}
{"id":"crystalmath-ae6.12","title":"[bug] Remote runner concurrency limits only throttle submissions","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:09:26.1432-06:00","updated_at":"2025-12-22T19:07:49.777073-06:00","closed_at":"2025-12-22T19:07:49.777073-06:00","labels":["P1","bug","high"],"dependencies":[{"issue_id":"crystalmath-ae6.12","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T10:09:26.144339-06:00","created_by":"briansquires"}],"comments":[{"id":20,"issue_id":"crystalmath-ae6.12","author":"briansquires","text":"Cross-validation finding: SSH/SLURM runners release semaphore after submission, not job completion. This is by design for SLURM (cluster scheduler manages concurrency), but problematic for SSHRunner. Proper fix requires QueueManager to track active job count or a background monitor. Deferring to Phase 4 as architectural improvement - current behavior is submission throttling, not execution limiting.","created_at":"2025-12-22T16:11:50Z"},{"id":21,"issue_id":"crystalmath-ae6.12","author":"briansquires","text":"Transferred to independent issue crystalmath-wlb for Phase 4. Closing this task.","created_at":"2025-12-22T16:17:42Z"}]}
{"id":"crystalmath-ae6.13","title":"[bug] Output parsers read wrong filename (job.out vs output{ext})","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:09:32.737969-06:00","updated_at":"2025-12-22T18:04:46.355748-06:00","closed_at":"2025-12-22T18:04:46.355748-06:00","labels":["P1","bug","medium"],"dependencies":[{"issue_id":"crystalmath-ae6.13","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T10:09:32.739037-06:00","created_by":"briansquires"}],"comments":[{"id":19,"issue_id":"crystalmath-ae6.13","author":"briansquires","text":"Fixed by adding _find_output_file() helper that searches for output.d12, output.out, output.log, job.out, and *.out patterns. All 10 parser tests pass.","created_at":"2025-12-22T16:11:33Z"}]}
{"id":"crystalmath-ae6.2","title":"[task] Fix LocalRunner result isolation and exception propagation","description":"local.py:281 _last_result is shared globally; local.py:553 get_status() uses it; local.py:521 swallows exceptions. Concurrent jobs report wrong status/result, failures silently masked. Fix: store results per JobHandle (e.g., _job_results[handle]) and surface exceptions.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T09:30:51.673724-06:00","updated_at":"2025-12-22T18:04:46.35051-06:00","closed_at":"2025-12-22T18:04:46.35051-06:00","labels":["high","local","runners"],"dependencies":[{"issue_id":"crystalmath-ae6.2","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:30:51.674414-06:00","created_by":"briansquires"}],"comments":[{"id":11,"issue_id":"crystalmath-ae6.2","author":"briansquires","text":"Fixed: Added per-job result storage (_job_results, _job_errors dicts), updated _run_job_task to store results/exceptions per handle, updated get_status() to use per-job results instead of global _last_result. Added get_job_result() and get_job_error() methods.","created_at":"2025-12-22T15:49:17Z"}]}
{"id":"crystalmath-ae6.3","title":"[task] Fix LocalRunner output file name mismatch in streaming","description":"local.py:223 writes output{ext}, but local.py:615 tails input{ext}. Output streaming often fails/never updates, leading to misleading UI and timeouts. Fix: align file naming - either tail output{ext} or track actual output filename during submission.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T09:31:22.684615-06:00","updated_at":"2025-12-22T18:04:46.35117-06:00","closed_at":"2025-12-22T18:04:46.35117-06:00","labels":["high","local","runners","streaming"],"dependencies":[{"issue_id":"crystalmath-ae6.3","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:22.68528-06:00","created_by":"briansquires"}],"comments":[{"id":12,"issue_id":"crystalmath-ae6.3","author":"briansquires","text":"Fixed: Changed get_output() to tail 'output{ext}' instead of 'input{ext}' to match the filename used by run_job() when writing output.","created_at":"2025-12-22T15:49:24Z"}]}
{"id":"crystalmath-ae6.4","title":"[task] Fix BaseRunner cleanup to terminate active subprocesses","description":"base.py:472 cleanup() cancels tasks only, but local.py:92 tracks subprocesses separately. Orphaned CRYSTAL processes keep running after cancellation/exit. Fix: override cleanup() in LocalRunner to terminate _active_processes (SIGTERM→SIGKILL) and clear them.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T09:31:28.797045-06:00","updated_at":"2025-12-22T18:04:46.351989-06:00","closed_at":"2025-12-22T18:04:46.351989-06:00","labels":["base","cleanup","high","runners"],"dependencies":[{"issue_id":"crystalmath-ae6.4","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:28.797691-06:00","created_by":"briansquires"}],"comments":[{"id":13,"issue_id":"crystalmath-ae6.4","author":"briansquires","text":"Fixed: Added cleanup() override in LocalRunner that terminates all active subprocesses (SIGTERM then SIGKILL after 5s timeout) before calling parent cleanup(). Also clears job result/error tracking dicts.","created_at":"2025-12-22T15:49:31Z"}]}
{"id":"crystalmath-ae6.5","title":"[task] Complete BaseRunner abstract method implementations","description":"base.py:306/336 abstract get_output()/retrieve_results() are still pass, local.py:661 is a no-op. Core runner contract incomplete; results retrieval unreliable across backends. Fix: implement fully across all runners and document the contract. TRANSFERRED from crystalmath-d6t.8","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:31:35.3775-06:00","updated_at":"2025-12-22T18:04:46.352695-06:00","closed_at":"2025-12-22T18:04:46.352695-06:00","labels":["api-contract","base","high","runners"],"dependencies":[{"issue_id":"crystalmath-ae6.5","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:35.378246-06:00","created_by":"briansquires"}],"comments":[{"id":15,"issue_id":"crystalmath-ae6.5","author":"briansquires","text":"Implemented retrieve_results() in LocalRunner with proper file copying from work_dir to dest. Uses code_config.auxiliary_outputs for file patterns. Includes:\n- Main output file copying (output.out)\n- Auxiliary output files (fort.9, fort.98, HESSOPT.DAT, OPTINFO.DAT, FREQINFO.DAT, fort.25)\n- Graceful error handling for missing files\n- Logging for all file operations\n- Respects cleanup parameter with config defaults\n- Handles same-directory edge case (work_dir == dest)","created_at":"2025-12-22T15:50:29Z"}]}
{"id":"crystalmath-ae6.6","title":"[task] Enforce concurrency limits in runners","description":"base.py:497 acquire_slot() is never used; local.py:487/ssh_runner.py:127/slurm_runner.py:165 submit without concurrency limits. max_concurrent_jobs is ignored; easy to overcommit local/remote resources. Fix: wrap job execution in 'async with self.acquire_slot():' in each runner.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:31:42.008216-06:00","updated_at":"2025-12-22T18:04:46.353177-06:00","closed_at":"2025-12-22T18:04:46.353177-06:00","labels":["concurrency","medium","runners"],"dependencies":[{"issue_id":"crystalmath-ae6.6","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:42.00899-06:00","created_by":"briansquires"}],"comments":[{"id":16,"issue_id":"crystalmath-ae6.6","author":"briansquires","text":"Added semaphore-based concurrency limiting to submit_job() in LocalRunner, SSHRunner, and SLURMRunner. All runners now respect max_concurrent_jobs setting.","created_at":"2025-12-22T15:50:50Z"}]}
{"id":"crystalmath-ae6.7","title":"[task] Fix SSHRunner status type mismatch","description":"ssh_runner.py:410 sets job_info['status'] = 'cancelled' (string, not enum). Mixed types can break status comparisons/UI logic. Fix: use JobStatus.CANCELLED enum value. TRANSFERRED from crystalmath-d6t.7 (partial)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:31:48.93485-06:00","updated_at":"2025-12-22T18:04:46.353624-06:00","closed_at":"2025-12-22T18:04:46.353624-06:00","labels":["medium","runners","ssh","typing"],"dependencies":[{"issue_id":"crystalmath-ae6.7","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:48.935532-06:00","created_by":"briansquires"}],"comments":[{"id":14,"issue_id":"crystalmath-ae6.7","author":"briansquires","text":"Fixed status type mismatches in SSHRunner. All status assignments now use JobStatus enum instead of strings. Changed lines 410 and 419 in ssh_runner.py from 'cancelled' (string) to JobStatus.CANCELLED (enum). Verified all other runners (SLURMRunner, LocalRunner) already use proper enum types.","created_at":"2025-12-22T15:50:18Z"}]}
{"id":"crystalmath-ae6.8","title":"[task] Implement custom output parsers","description":"After runner correctness and contract work is complete, implement custom output parsers to reliably evaluate job success across runners. TRANSFERRED from crystalmath-d6t.6","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:31:55.455761-06:00","updated_at":"2025-12-22T18:04:46.354071-06:00","closed_at":"2025-12-22T18:04:46.354071-06:00","labels":["feature","orchestrator","parsers"],"dependencies":[{"issue_id":"crystalmath-ae6.8","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:31:55.456344-06:00","created_by":"briansquires"}],"comments":[{"id":17,"issue_id":"crystalmath-ae6.8","author":"briansquires","text":"Implemented custom output parser registry in WorkflowOrchestrator. Added register_parser(), _get_output_parser() methods and example parsers for energy, bandgap, and lattice extraction. Updated _extract_node_results() to apply registered parsers with graceful error handling. All 10 tests passing.","created_at":"2025-12-22T15:51:53Z"}]}
{"id":"crystalmath-ae6.9","title":"[task] Cross-validate epic completion with Codex/Gemini","description":"BLOCKED until all implementation tasks (ae6.1-ae6.8) are closed. After implementation complete: 1) Run Codex review via clink 2) Run Gemini review via clink 3) If issues found, reopen/create issues and fix 4) Only close when both approve. Per hookify epic workflow.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T09:33:26.398413-06:00","updated_at":"2025-12-22T18:04:46.354501-06:00","closed_at":"2025-12-22T18:04:46.354501-06:00","labels":["blocked","quality","validation"],"dependencies":[{"issue_id":"crystalmath-ae6.9","depends_on_id":"crystalmath-ae6","type":"parent-child","created_at":"2025-12-22T09:33:26.399085-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-am9","title":"Remove .bak backup scripts from cli/lib","description":"Dead backup files linger in cli/lib directory alongside active modules:\n- cli/lib/cry-parallel.sh.bak\n- cli/lib/cry-stage.sh.bak\n- cli/lib/cry-ui.sh.bak\n\nFix:\n- Delete .bak files or archive outside repository\n- Ensure module loader only ships canonical modules\n- Update .gitignore to exclude .bak files\n- Clean up any other backup/temp files\n- Document that git history preserves old versions\n\nImpact: Contributors may load wrong file, doubles maintenance burden, confusing repository structure.\n\nFiles: cli/lib/*.bak\n\nRecommendation: Delete and rely on git history for recovery if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:45.134755-06:00","updated_at":"2025-11-23T14:59:49.304451-06:00","closed_at":"2025-11-23T14:59:49.304451-06:00","labels":["cleanup","cli","maintainability"]}
{"id":"crystalmath-as9","title":"Create BaseRunner abstract interface","description":"Define BaseRunner abstract base class in src/runners/base.py.\n\nInterface methods:\n- async run_job(job_id, work_dir, threads) -\u003e AsyncIterator[str]\n- async stop_job(job_id) -\u003e bool\n- is_job_running(job_id) -\u003e bool\n- get_process_pid(job_id) -\u003e Optional[int]\n\nPurpose:\n- Unified interface for LocalRunner, SSHRunner, SLURMRunner\n- Type hints for runner implementations\n- Enforces contract for all execution backends\n\nImplementation:\n- Use abc.ABC and @abstractmethod\n- Document expected behavior for each method\n- Add type hints for all parameters\n\nDependencies:\n- None (creates new module)\n\nBlocks:\n- SSH Runner implementation\n- SLURM Runner implementation\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.1","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:10.269958-06:00","updated_at":"2025-11-21T06:56:03.252796-06:00","closed_at":"2025-11-21T06:56:03.252796-06:00","labels":["architecture","phase-2","remote-execution"]}
{"id":"crystalmath-awi","title":"Add Input File Preview","description":"Display selected job's input file in Input tab. Load .d12 file when job selected, add syntax highlighting for CRYSTAL input, and provide read-only view for completed jobs.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:28.769112-06:00","updated_at":"2025-11-20T23:25:21.403257-06:00","closed_at":"2025-11-20T23:25:21.403257-06:00","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-b42","title":"HIGH: Fix _last_result race condition in concurrent job execution","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:08:39.543084-06:00","updated_at":"2025-12-22T19:16:56.187499-06:00","closed_at":"2025-12-22T19:16:56.187499-06:00"}
{"id":"crystalmath-b8j","title":"TUI Core Refactoring \u0026 Hardening","description":"Comprehensive refactoring of the TUI core to address architectural debt, optimize performance, and harden security based on the December 2025 codebase audit.\n\n## Key Findings from Analysis:\n- **Architecture**: Job class becoming 'God Object' with mixed local/remote/code-specific fields\n- **Performance**: TUI _refresh_job_list does full table wipe-and-reload (bottleneck)\n- **Code Quality**: SLURMRunner uses string concatenation for script generation\n- **Duplication**: SSHRunner and SLURMRunner share file transfer logic\n\n## Recommended Execution Order (from Codex validation):\n⚠️ **Important**: Do DB normalization (crystalmath-cmy) BEFORE deep runner refactors (crystalmath-c6z, crystalmath-7cp) to avoid schema-driven rework.\n\n## Phases:\n1. Architecture \u0026 Data Model - Split Job table, incremental TUI updates\n2. Runner Refactoring - Extract RemoteBaseRunner, template SLURM scripts  \n3. Security \u0026 Testing - Enforce strict host key checking, add integration tests\n\n## Acceptance Criteria:\n- TUI job list handles 1000+ jobs without UI lag\n- SLURM scripts generated via Jinja2 templates\n- Integration tests pass for SSH/SLURM runners\n- Refresh triggers debounced during bursts\n- Performance budget established and verified","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T13:29:08.185845-06:00","updated_at":"2025-12-17T14:31:57.260752-06:00","dependencies":[{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-7dl","type":"blocks","created_at":"2025-12-17T13:30:17.792363-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-c6z","type":"blocks","created_at":"2025-12-17T13:30:22.895045-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-7cp","type":"blocks","created_at":"2025-12-17T13:30:27.977531-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-cmy","type":"blocks","created_at":"2025-12-17T13:30:33.149249-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-w1w","type":"blocks","created_at":"2025-12-17T14:31:28.328453-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-6fm","type":"blocks","created_at":"2025-12-17T14:31:33.457253-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-b8j","depends_on_id":"crystalmath-4x0","type":"blocks","created_at":"2025-12-17T14:31:38.58959-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-be3","title":"Implement lib/cry-ui.sh (visual components)","description":"Move visual functions from runcrystal:74-118. Includes ui_banner(), ui_card(), ui_status_line(), ui_file_found(), ui_spin(). Implements theme system","design":"From gemini: Functions use CRY_THEME associative array. From codex: Implement cry_ui_init() to handle gum bootstrap, set CRY_HAS_GUM flag, graceful degrade to plain text when gum missing. Theme registry pattern for cry-docs reuse","acceptance_criteria":"- All UI functions extracted from runcrystal\n- Theme system implemented with CRY_THEME_DEFAULT\n- Graceful fallback when gum missing\n- Module testable independently","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.777197-06:00","updated_at":"2025-11-19T20:57:16.162002-06:00","closed_at":"2025-11-19T20:57:16.162002-06:00","dependencies":[{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-3cv","type":"blocks","created_at":"2025-11-19T20:36:49.693572-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-hyl","type":"blocks","created_at":"2025-11-19T20:36:49.737708-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-ib2","type":"blocks","created_at":"2025-11-19T20:36:49.784108-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-a2j","type":"blocks","created_at":"2025-11-19T20:36:49.831244-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-wwa","type":"blocks","created_at":"2025-11-19T20:36:49.853996-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.945857-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-pq3","type":"blocks","created_at":"2025-11-19T20:36:50.202927-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.454496-06:00","created_by":"daemon"},{"issue_id":"crystalmath-be3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.05997-06:00","created_by":"daemon"}]}
{"id":"crystalmath-bj8","title":"Implement Template System with Jinja2","description":"Create TemplateManager class in src/core/templates.py.\n\nFeatures:\n- Jinja2-based template rendering\n- Template metadata parsing\n- Parameter validation\n- Template library management\n\nImplementation:\n\n\nTemplate format:\n- Use .j2 extension\n- Metadata in header comments\n- Parameter documentation\n- Default values\n\nExample templates:\n- optimization.d12.j2 (geometry optimization)\n- scf.d12.j2 (single point calculation)\n- bands.d12.j2 (band structure)\n- dos.d12.j2 (density of states)\n\nSee: tui/docs/PHASE2_DESIGN.md section 4.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:18.403006-06:00","updated_at":"2025-11-21T06:58:01.423995-06:00","closed_at":"2025-11-21T06:58:01.423995-06:00","labels":["core","phase-2","templates"]}
{"id":"crystalmath-c6z","title":"Extract Common Remote Runner Logic","description":"SSHRunner and SLURMRunner share SFTP and connection handling logic. Extract this into a shared RemoteBaseRunner class to reduce duplication and improve maintainability.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T13:29:39.671478-06:00","updated_at":"2025-12-17T18:40:40.149197-06:00","closed_at":"2025-12-17T18:40:40.149197-06:00"}
{"id":"crystalmath-cmy","title":"Normalize Database Job Model","description":"Refactor the jobs table. Move runner-specific config (parallelism, cluster_id) and results (final_energy, key_results) into separate linked tables to reduce main table width and improve query efficiency.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T13:30:04.72387-06:00","updated_at":"2025-12-17T15:14:47.161792-06:00","closed_at":"2025-12-17T15:14:47.161792-06:00"}
{"id":"crystalmath-cn9","title":"AiiDA Integration Epic","description":"Epic: Migrate CRYSTAL-TOOLS TUI from SQLite + custom workflow engine to full AiiDA backend with PostgreSQL, WorkChains, and provenance tracking.\n\nTimeline: 8-12 weeks\nDesign Document: tui/docs/AIIDA_INTEGRATION_DESIGN.md\n\nBenefits:\n- Full provenance tracking\n- Mature workflow engine\n- aiida-crystal-dft ecosystem integration\n- Web interface (future)\n- Community standard approach\n\nTrade-offs:\n- Requires PostgreSQL + RabbitMQ\n- Heavier infrastructure\n- Migration complexity","status":"open","priority":0,"issue_type":"epic","created_at":"2025-11-23T16:11:48.003309-06:00","updated_at":"2025-11-23T16:11:48.003309-06:00","labels":["aiida integration architecture phase-3"]}
{"id":"crystalmath-cn9.1","title":"Install and configure AiiDA with PostgreSQL","description":"Install AiiDA 2.7+, PostgreSQL 12+, and RabbitMQ. Create crystal-tui profile.\n\nTasks:\n- Install PostgreSQL and create aiida_crystal_tui database\n- Install RabbitMQ message broker\n- Install aiida-core and aiida-crystal-dft\n- Run verdi quicksetup to create profile\n- Start AiiDA daemon\n- Verify installation with test calculation\n\nFiles:\n- tui/pyproject.toml (add dependencies)\n- README.md (update installation instructions)\n\nAcceptance: verdi status shows all green","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:12:07.079098-06:00","updated_at":"2025-11-24T22:07:27.739398-06:00","closed_at":"2025-11-24T22:07:27.7394-06:00","labels":["aiida infrastructure phase-3 setup"]}
{"id":"crystalmath-cn9.10","title":"Implement WorkChain submission from TUI","description":"Enable job submission via AiiDA WorkChains from TUI interface.\n\nTasks:\n- Update NewJobModal to submit WorkChains\n- Build WorkChain inputs from form data\n- Handle Code/Computer selection\n- Display WorkChain PK and provenance link\n- Add submission error handling\n- Test various job types\n\nFiles:\n- tui/src/tui/screens/new_job.py (modify)\n- tui/src/aiida/submission.py (new helper)\n\nAcceptance: Jobs submitted successfully via TUI launch WorkChains","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:13:38.207098-06:00","updated_at":"2025-11-24T22:10:08.480153-06:00","closed_at":"2025-11-24T22:10:08.480156-06:00","labels":["aiida submission ui phase-3"]}
{"id":"crystalmath-cn9.11","title":"Add comprehensive AiiDA integration tests","description":"Create comprehensive test suite for AiiDA integration.\n\nTasks:\n- Unit tests for all adapters\n- Integration tests for CalcJobs and WorkChains\n- End-to-end TUI workflow tests\n- Performance benchmarks (query speed)\n- Test migration scenarios\n- CI/CD integration\n\nFiles:\n- tui/tests/test_aiida_integration.py (new)\n- tui/tests/integration/ (new suite)\n- .github/workflows/aiida_tests.yml (CI)\n\nAcceptance: 90%+ test coverage for AiiDA modules","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-23T16:13:43.880338-06:00","updated_at":"2025-11-23T16:13:43.880338-06:00","labels":["aiida testing phase-3 qa"]}
{"id":"crystalmath-cn9.12","title":"Create AiiDA integration documentation","description":"Write comprehensive documentation for AiiDA integration.\n\nTasks:\n- Installation and setup guide\n- Migration guide from legacy mode\n- User guide for AiiDA features\n- Developer guide for extending\n- Troubleshooting section\n- API documentation\n\nFiles:\n- docs/AIIDA_SETUP.md (new)\n- docs/MIGRATION_GUIDE.md (new)\n- docs/AIIDA_USER_GUIDE.md (new)\n- docs/AIIDA_DEVELOPER_GUIDE.md (new)\n- README.md (update with AiiDA info)\n\nAcceptance: Documentation complete and tested by external user","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-23T16:13:49.548491-06:00","updated_at":"2025-11-23T16:13:49.548491-06:00","labels":["aiida documentation phase-3"]}
{"id":"crystalmath-cn9.2","title":"Setup AiiDA Computers and Codes","description":"Configure AiiDA Computers (localhost, SSH clusters) and Codes (crystalOMP, PcrystalOMP).\n\nTasks:\n- Create localhost Computer with direct scheduler\n- Create SSH Computer configurations for remote clusters\n- Register CRYSTAL23 codes (crystalOMP and PcrystalOMP)\n- Configure transport and scheduler settings\n- Test code execution with simple calculation\n\nFiles:\n- tui/src/aiida/setup/computers.py (new)\n- tui/src/aiida/setup/codes.py (new)\n- docs/AIIDA_SETUP.md (new)\n\nAcceptance: verdi code list shows CRYSTAL23 codes","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:12:12.691978-06:00","updated_at":"2025-11-24T22:07:33.364811-06:00","closed_at":"2025-11-24T22:07:33.364812-06:00","labels":["aiida configuration phase-3 setup"]}
{"id":"crystalmath-cn9.3","title":"Implement AiiDA QueryBuilder adapter for database.py","description":"Create AiiDA QueryBuilder adapter that maintains TUI's database interface while querying AiiDA nodes.\n\nTasks:\n- Implement AiiDAQueryAdapter class\n- Map TUI status to AiiDA ProcessState\n- Implement list_jobs(), get_job(), create_job()\n- Handle job filtering and sorting\n- Extract results from AiiDA node outputs\n- Add comprehensive tests\n\nFiles:\n- tui/src/aiida/query_adapter.py (new)\n- tui/tests/test_aiida_adapter.py (new)\n\nAcceptance: All existing database tests pass with adapter","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:12:36.825781-06:00","updated_at":"2025-11-24T22:07:38.976226-06:00","closed_at":"2025-11-24T22:07:38.976227-06:00","labels":["aiida adapter architecture phase-3"]}
{"id":"crystalmath-cn9.4","title":"Create database migration utility","description":"Build utility to migrate existing SQLite jobs to AiiDA nodes with full provenance.\n\nTasks:\n- Read existing SQLite database\n- Create AiiDA nodes for each job\n- Preserve job metadata (timestamps, status, etc.)\n- Link inputs/outputs\n- Handle error cases gracefully\n- Create migration documentation\n\nFiles:\n- tui/src/aiida/migration.py (new)\n- scripts/migrate_to_aiida.sh (new)\n- docs/MIGRATION_GUIDE.md (new)\n\nAcceptance: Test migration completes without data loss","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-23T16:12:42.444286-06:00","updated_at":"2025-11-24T22:07:44.586019-06:00","closed_at":"2025-11-24T22:07:44.586023-06:00","labels":["aiida migration phase-3 data"]}
{"id":"crystalmath-cn9.5","title":"Implement CRYSTAL23 CalcJob","description":"Implement AiiDA CalcJob for CRYSTAL23 calculations, replacing current runner logic.\n\nTasks:\n- Define CalcJob inputs/outputs spec\n- Implement prepare_for_submission()\n- Generate d12 input files\n- Configure job resources (MPI/OpenMP)\n- Define exit codes for error handling\n- Add unit tests\n\nFiles:\n- tui/src/aiida/calcjobs/crystal23.py (new)\n- tui/tests/test_crystal23_calcjob.py (new)\n\nAcceptance: Test calculation runs successfully via CalcJob","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:12:48.067555-06:00","updated_at":"2025-11-24T22:07:50.209744-06:00","closed_at":"2025-11-24T22:07:50.20975-06:00","labels":["aiida calcjob crystal phase-3"]}
{"id":"crystalmath-cn9.6","title":"Implement CRYSTAL23 output parser","description":"Implement AiiDA Parser for CRYSTAL23 output files using CRYSTALpytools with fallback.\n\nTasks:\n- Create Crystal23Parser class\n- Parse energy, convergence, SCF iterations\n- Extract optimization geometry (if applicable)\n- Handle parsing errors gracefully\n- Fallback manual parsing if CRYSTALpytools unavailable\n- Add parser tests\n\nFiles:\n- tui/src/aiida/parsers/crystal23.py (new)\n- tui/tests/test_crystal23_parser.py (new)\n\nAcceptance: Parser extracts all key results correctly","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:12:53.688511-06:00","updated_at":"2025-11-24T22:07:55.837375-06:00","closed_at":"2025-11-24T22:07:55.837377-06:00","labels":["aiida parser crystal phase-3"]}
{"id":"crystalmath-cn9.7","title":"Implement base CRYSTAL WorkChain with error handling","description":"Create base WorkChain for CRYSTAL23 with automatic restart and error handling.\n\nTasks:\n- Define WorkChain inputs/outputs spec\n- Implement workflow outline (setup → validate → run → inspect → results)\n- Add automatic restart on recoverable errors\n- Handle SCF convergence issues\n- Validate results and set exit codes\n- Add WorkChain tests\n\nFiles:\n- tui/src/aiida/workchains/crystal_base.py (new)\n- tui/tests/test_crystal_workchain.py (new)\n\nAcceptance: WorkChain successfully runs and handles errors","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:13:21.245514-06:00","updated_at":"2025-11-24T22:08:01.449406-06:00","closed_at":"2025-11-24T22:08:01.449408-06:00","labels":["aiida workchain crystal phase-3"]}
{"id":"crystalmath-cn9.8","title":"Implement geometry optimization WorkChain","description":"Create WorkChain for multi-step geometry optimization workflows.\n\nTasks:\n- Define GeometryOptimization WorkChain\n- Implement iterative optimization loop\n- Check convergence criteria (forces, displacements)\n- Store optimization trajectory\n- Handle optimization failures\n- Add tests with various structures\n\nFiles:\n- tui/src/aiida/workchains/crystal_geopt.py (new)\n- tui/tests/test_geopt_workchain.py (new)\n\nAcceptance: Optimization WorkChain converges successfully","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-23T16:13:26.894908-06:00","updated_at":"2025-11-24T22:08:07.056175-06:00","closed_at":"2025-11-24T22:08:07.056177-06:00","labels":["aiida workchain optimization phase-3"]}
{"id":"crystalmath-cn9.9","title":"Update TUI screens to use AiiDA adapter","description":"Update all TUI screens to use AiiDA adapter instead of direct database access.\n\nTasks:\n- Update JobListScreen to use AiiDAQueryAdapter\n- Update job detail screens\n- Modify job submission to use WorkChains\n- Update status monitoring\n- Test all UI workflows\n- Update UI documentation\n\nFiles:\n- tui/src/tui/screens/*.py (modify existing)\n- docs/UI_GUIDE.md (update)\n\nAcceptance: All TUI screens functional with AiiDA backend","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-23T16:13:32.548919-06:00","updated_at":"2025-11-24T22:10:02.85315-06:00","closed_at":"2025-11-24T22:10:02.853154-06:00","labels":["aiida ui integration phase-3"]}
{"id":"crystalmath-d6t","title":"TUI Quality Improvements Epic - Phase 2 Stabilization","description":"","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-10T07:20:22.352466-06:00","updated_at":"2025-12-22T18:31:46.800438-06:00","closed_at":"2025-12-22T18:31:46.800438-06:00","labels":["phase-2-stabilization","quality","refactor"]}
{"id":"crystalmath-d6t.1","title":"Consolidate Exception Hierarchy","description":"Remove duplicate exception classes from base.py and consolidate into exceptions.py.\n\n## Issue Reference\nCRIT-002, HIGH-001\n\n## Files\n- tui/src/runners/base.py (lines 516-563)\n- tui/src/runners/exceptions.py\n\n## Problem\nSame exception classes (ConnectionError, ExecutionError, TimeoutError, etc.) defined in TWO files.\nThis causes isinstance() checks to fail across module boundaries.\n\n## Tasks\n- Remove duplicate exception classes from base.py (lines 516-563)\n- Keep all exceptions in exceptions.py\n- Add runner-specific exceptions (SLURMError, SSHError, LocalError)\n- Update imports in local_runner.py, ssh_runner.py, slurm_runner.py\n- Update imports in orchestrator.py\n- Update runners/__init__.py to re-export exceptions\n- Run tests to verify no import errors\n\n## Verification\n```bash\ngrep -r 'class.*Error.*Exception' tui/src/runners/\n# Should only show exceptions.py\n```\n\n## Reference\ndocs/analysis/EXCEPTION_HIERARCHY_ISSUE.md","status":"closed","priority":0,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:21:46.407338-06:00","updated_at":"2025-12-12T11:25:28.981327-06:00","closed_at":"2025-12-12T11:25:28.981327-06:00","labels":["critical","exceptions","phase-1","refactor"],"dependencies":[{"issue_id":"crystalmath-d6t.1","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:21:46.411026-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.10","title":"Fix Entry Point Configuration","description":"Verify entry point matches actual module structure.\n\n## Issue Reference\nMED-002\n\n## Files\n- tui/pyproject.toml (line 70)\n- tui/src/main.py\n\n## Problem\nEntry point references src.main:main but imports app_enhanced module.\nMay work in editable installs but fail in regular installations.\n\n```toml\n[project.scripts]\ncrystal-tui = 'src.main:main'\n```\n\n## Tasks\n- Verify entry point matches actual module structure\n- Update documentation if needed\n- Test crystal-tui command after installation","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2025-12-10T07:24:15.413888-06:00","updated_at":"2025-12-22T18:31:36.396189-06:00","closed_at":"2025-12-22T18:31:36.396189-06:00","labels":["config","medium","packaging","phase-3"],"dependencies":[{"issue_id":"crystalmath-d6t.10","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:24:15.414744-06:00","created_by":"briansquires"}],"comments":[{"id":24,"issue_id":"crystalmath-d6t.10","author":"briansquires","text":"Verified entry point src.main:main is correct. The import works and main function is accessible.","created_at":"2025-12-23T00:14:32Z"}]}
{"id":"crystalmath-d6t.11","title":"Add Graceful Fallbacks for Optional Dependencies","description":"Handle missing optional dependencies gracefully.\n\n## Issue Reference\nMED-003\n\n## Files\n- Multiple analysis/visualization modules\n\n## Problem\nAnalysis dependencies (CRYSTALpytools, pymatgen, ase) are optional but code may not handle their absence gracefully, leading to runtime errors.\n\n## Tasks\n- Add try/except imports for CRYSTALpytools\n- Add try/except imports for pymatgen\n- Add try/except imports for ase\n- Display helpful error message when optional dependency missing\n- Add --check-deps command to verify dependencies","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:24:23.106752-06:00","updated_at":"2025-12-22T18:31:36.396925-06:00","closed_at":"2025-12-22T18:31:36.396925-06:00","labels":["dependencies","feature","medium","phase-3"],"dependencies":[{"issue_id":"crystalmath-d6t.11","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:24:23.108329-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.12","title":"Clean Up AiiDA Integration","description":"Mark AiiDA as experimental and add feature flag.\n\n## Issue Reference\nMED-004\n\n## Files\n- tui/src/aiida/\n- tui/src/core/backend.py\n\n## Problem\nAiiDA integration code exists but is marked as 'Phase 3' in documentation.\nThe backend auto-detection tries to use AiiDA features, creating confusion.\n\n## Tasks\n- Mark AiiDA integration as experimental in README\n- Add feature flag to enable/disable AiiDA\n- Add graceful fallback when AiiDA not installed\n- Update backend.py to handle missing AiiDA","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:24:31.196249-06:00","updated_at":"2025-12-22T18:31:36.397469-06:00","closed_at":"2025-12-22T18:31:36.397469-06:00","labels":["aiida","medium","phase-3","refactor"],"dependencies":[{"issue_id":"crystalmath-d6t.12","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:24:31.196933-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.13","title":"Improve CLI Configuration Validation","description":"Add comprehensive validation for CLI environment variables.\n\n## Issue Reference\nMED-005\n\n## Files\n- cli/lib/cry-config.sh (313 lines)\n\n## Problem\nThe CLI relies heavily on environment variables without comprehensive validation.\nInvalid configurations may not be caught early, leading to confusing failures.\n\n## Tasks\n- Add validation function for environment variables\n- Check CRY23_ROOT exists and contains CRYSTAL\n- Check CRY_SCRATCH_BASE is writable\n- Add helpful error messages for missing config\n- Add --validate flag to check configuration","status":"closed","priority":2,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:24:37.947574-06:00","updated_at":"2025-12-22T18:31:36.398127-06:00","closed_at":"2025-12-22T18:31:36.398127-06:00","labels":["cli","feature","medium","phase-3"],"dependencies":[{"issue_id":"crystalmath-d6t.13","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:24:37.948341-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.14","title":"Fix Database Pool Deprecation Warning","description":"Remove deprecated .conn property from database.\n\n## Issue Reference\nLOW-001\n\n## Files\n- tui/src/core/database.py\n\n## Problem\nThe .conn property has a deprecation warning in docstring but is still used.\n\n## Tasks\n- Remove deprecated .conn property\n- Update all callers to use proper pool access","status":"closed","priority":3,"issue_type":"task","estimated_minutes":60,"created_at":"2025-12-10T07:25:05.763781-06:00","updated_at":"2025-12-22T18:31:36.398645-06:00","closed_at":"2025-12-22T18:31:36.398645-06:00","labels":["cleanup","database","low","phase-4"],"dependencies":[{"issue_id":"crystalmath-d6t.14","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:25:05.765083-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.15","title":"Clean Up Test Suite","description":"Fix tests that validate stub implementations.\n\n## Issue Reference\nLOW-002\n\n## Files\n- tui/tests/\n\n## Problem\nTests exist for stubbed functionality (workflow execution, job cancellation),\nwhich may pass but validate non-functional code.\n\n## Tasks\n- Identify tests that validate stub implementations\n- Mark them as @pytest.mark.xfail until feature implemented\n- Add tests for actual implementations\n- Add CI/CD pipeline to run tests","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2025-12-10T07:25:12.00669-06:00","updated_at":"2025-12-22T18:31:36.399155-06:00","closed_at":"2025-12-22T18:31:36.399155-06:00","labels":["low","phase-4","testing"],"dependencies":[{"issue_id":"crystalmath-d6t.15","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:25:12.007847-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.16","title":"Fix BASH_SOURCE Robustness","description":"Improve script location detection in CLI.\n\n## Issue Reference\nLOW-003\n\n## Files\n- cli/lib/cry-config.sh (line 38)\n\n## Problem\nThe ${BASH_SOURCE[0]:-$0} pattern may fail when script is sourced in certain contexts.\n\n## Tasks\n- Add more robust script location detection\n- Test in various sourcing scenarios","status":"closed","priority":3,"issue_type":"task","estimated_minutes":60,"created_at":"2025-12-10T07:25:20.060577-06:00","updated_at":"2025-12-22T18:31:36.399655-06:00","closed_at":"2025-12-22T18:31:36.399655-06:00","labels":["cli","low","phase-4","robustness"],"dependencies":[{"issue_id":"crystalmath-d6t.16","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:25:20.061615-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.17","title":"Add Keyring Fallback","description":"Add fallback credential storage for headless systems.\n\n## Issue Reference\nLOW-004\n\n## Files\n- tui/src/core/connection_manager.py\n\n## Problem\nUses keyring library but may not have fallback for headless/server environments\nwhere keyring backends are unavailable.\n\n## Tasks\n- Detect if keyring backend is available\n- Add fallback to encrypted file storage\n- Add warning when using fallback","status":"closed","priority":3,"issue_type":"task","estimated_minutes":120,"created_at":"2025-12-10T07:25:26.886805-06:00","updated_at":"2025-12-22T18:31:36.400167-06:00","closed_at":"2025-12-22T18:31:36.400167-06:00","labels":["feature","low","phase-4","security"],"dependencies":[{"issue_id":"crystalmath-d6t.17","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:25:26.88809-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.2","title":"Implement Workflow Execution","description":"Replace stubbed workflow execution with real runner integration.\n\n## Issue Reference\nCRIT-001\n\n## Files\n- tui/src/core/workflow.py (lines 641-680)\n\n## Problem\nThe _execute_node() method is completely stubbed:\n- Uses asyncio.sleep(0.1) instead of real execution\n- Returns hardcoded mock results: {energy: -123.456, converged: True, iterations: 10}\n- No actual CRYSTAL23 calculations are performed\n\n## Tasks\n- Implement _get_runner() helper method\n- Implement _prepare_work_dir() helper method\n- Implement _stage_input_files() helper method\n- Implement _wait_for_job() with polling\n- Implement _parse_results() for CRYSTAL output\n- Replace stub in _execute_node() with real implementation\n- Add cancellation support\n- Add timeout handling\n- Add unit tests for each helper method\n- Add integration test with mock runner\n\n## Estimated Effort\n8-16 hours (largest single item)\n\n## Reference\ndocs/analysis/WORKFLOW_EXECUTION_STUB.md","status":"closed","priority":0,"issue_type":"task","estimated_minutes":720,"created_at":"2025-12-10T07:22:02.802535-06:00","updated_at":"2025-12-12T11:36:16.278243-06:00","closed_at":"2025-12-12T11:36:16.278243-06:00","labels":["critical","feature","phase-1","workflow"],"dependencies":[{"issue_id":"crystalmath-d6t.2","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:22:02.803397-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-d6t.2","depends_on_id":"crystalmath-d6t.1","type":"blocks","created_at":"2025-12-10T07:26:22.517174-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.3","title":"Implement Job Cancellation","description":"Implement the cancel_job() method in orchestrator.py.\n\n## Issue Reference\nCRIT-003\n\n## Files\n- tui/src/core/orchestrator.py (line 515)\n\n## Problem\nThe cancel_job() method is a stub with no implementation:\n```python\nasync def cancel_job(self, job_id: int) -\u003e bool:\n    # TODO: Call queue_manager to stop job\n    pass\n```\n\nUsers cannot cancel running jobs, leading to resource management issues.\n\n## Tasks\n- Implement cancel_job() method in orchestrator\n- Call queue_manager.cancel_job(job_id)\n- Update job status in database to CANCELLED\n- Handle already-completed jobs gracefully (return False)\n- Add notification to TUI on cancellation\n- Add unit test for cancellation\n- Add test for cancelling completed job (should return False)\n\n## Verification\n```python\njob_id = await orchestrator.submit_job(...)\nsuccess = await orchestrator.cancel_job(job_id)\nassert success is True\njob = await db.get_job(job_id)\nassert job.status == JobStatus.CANCELLED\n```\n\n## Dependencies\nDepends on crystalmath-d6t.1 (exception hierarchy) for proper error handling","status":"closed","priority":0,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:22:18.147842-06:00","updated_at":"2025-12-17T08:03:22.853241-06:00","closed_at":"2025-12-17T08:03:22.853241-06:00","labels":["critical","feature","orchestrator","phase-1"],"dependencies":[{"issue_id":"crystalmath-d6t.3","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:22:18.149305-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-d6t.3","depends_on_id":"crystalmath-d6t.1","type":"blocks","created_at":"2025-12-10T07:26:15.14732-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.4","title":"Fix Database Async Safety","description":"Replace thread-safe SimpleQueue with async-safe implementation.\n\n## Issue Reference\nHIGH-002\n\n## Files\n- tui/src/core/database.py (lines 199-279)\n\n## Problem\nDatabase uses queue.SimpleQueue for connection pooling which is thread-safe but NOT async-safe.\nThe TUI uses async code throughout, leading to:\n- Potential deadlocks in async contexts\n- Race conditions during concurrent database access\n- Connection leaks if exceptions occur during async operations\n\n```python\n# Line 204 in database.py\nself._connection_pool: SimpleQueue[sqlite3.Connection] = SimpleQueue()\n```\n\n## Options\n**Option A:** Replace SimpleQueue with asyncio.Queue\n**Option B:** Migrate to aiosqlite for full async support\n\n## Tasks\n- Choose implementation approach (A or B)\n- Update all database operations to be async-safe\n- Add connection timeout handling\n- Add connection retry logic\n- Update tests for async database operations\n- Add concurrency stress test","status":"closed","priority":1,"issue_type":"task","estimated_minutes":360,"created_at":"2025-12-10T07:23:01.010457-06:00","updated_at":"2025-12-17T08:12:11.415689-06:00","closed_at":"2025-12-17T08:12:11.415689-06:00","labels":["database","high","phase-2","refactor"],"dependencies":[{"issue_id":"crystalmath-d6t.4","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:23:01.012032-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.5","title":"Fix Encapsulation Violations","description":"Fix direct access to private ConnectionManager._configs in SSH runner.\n\n## Issue Reference\nHIGH-003\n\n## Files\n- tui/src/runners/ssh_runner.py (line 96)\n- tui/src/core/connection_manager.py\n\n## Problem\nThe SSH runner directly accesses private _configs dictionary:\n```python\n# Line 96 in ssh_runner.py\nif cluster_id not in connection_manager._configs:\n    raise ConfigurationError(f'Unknown cluster: {cluster_id}')\n```\n\nThis breaks encapsulation and will fail if ConnectionManager internals change.\n\n## Tasks\n- Add has_cluster(cluster_id: str) -\u003e bool method to ConnectionManager\n- Add get_cluster_config(cluster_id: str) -\u003e Optional[ClusterConfig] method\n- Update SSHRunner to use public methods\n- Update tests","status":"closed","priority":1,"issue_type":"task","estimated_minutes":90,"created_at":"2025-12-10T07:23:08.139775-06:00","updated_at":"2025-12-17T08:11:57.192387-06:00","closed_at":"2025-12-17T08:11:57.192387-06:00","labels":["high","phase-2","refactor","ssh"],"dependencies":[{"issue_id":"crystalmath-d6t.5","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:23:08.140679-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-d6t.6","title":"Implement Custom Output Parsers","description":"Implement the custom output parser system for orchestrator.\n\n## Issue Reference\nHIGH-004\n\n## Files\n- tui/src/core/orchestrator.py (lines 862-875)\n\n## Problem\nThe orchestrator has a TODO for applying custom output parsers that is not implemented:\n```python\n# Lines 862-875 in orchestrator.py\n# TODO: Apply custom output parsers if specified\n# This would allow users to define custom parsing logic\n# for specific output formats\n```\n\n## Tasks\n- Define OutputParser protocol/interface\n- Implement default CRYSTAL output parser\n- Add parser registration system\n- Implement parser selection in orchestrator\n- Add example custom parser\n- Add documentation for custom parsers","status":"closed","priority":1,"issue_type":"task","estimated_minutes":300,"created_at":"2025-12-10T07:23:14.576035-06:00","updated_at":"2025-12-22T09:33:03.002234-06:00","closed_at":"2025-12-22T09:33:03.002234-06:00","labels":["feature","high","orchestrator","phase-2"],"dependencies":[{"issue_id":"crystalmath-d6t.6","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:23:14.577788-06:00","created_by":"briansquires"},{"issue_id":"crystalmath-d6t.6","depends_on_id":"crystalmath-d6t.2","type":"blocks","created_at":"2025-12-10T07:26:31.235138-06:00","created_by":"briansquires"}],"comments":[{"id":9,"issue_id":"crystalmath-d6t.6","author":"briansquires","text":"TRANSFERRED to crystalmath-ae6.8 in new Runner Correctness \u0026 Data Safety Sprint epic. This issue depends on runner correctness work and will be addressed after contract completion.","created_at":"2025-12-22T15:32:37Z"}]}
{"id":"crystalmath-d6t.7","title":"Fix Abstract Base Classes","description":"Add proper @abstractmethod decorators to ABC classes.\n\n## Issue Reference\nHIGH-005\n\n## Files\n- tui/src/tui/widgets/auto_form.py (lines 200-205)\n- tui/src/runners/base.py\n\n## Problem\nFormField base class has abstract methods that raise NotImplementedError but are not properly decorated:\n```python\n# Lines 200-205 in auto_form.py\ndef get_value(self) -\u003e Any:\n    raise NotImplementedError\n\ndef set_value(self, value: Any) -\u003e None:\n    raise NotImplementedError\n```\n\nWithout @abstractmethod, subclasses can be instantiated without implementing required methods.\n\n## Tasks\n- Add @abstractmethod decorators to FormField\n- Add @abstractmethod decorators to BaseRunner\n- Import ABC from abc module\n- Verify all subclasses implement required methods\n- Add type hints to abstract methods","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:23:21.413491-06:00","updated_at":"2025-12-22T09:32:57.821318-06:00","closed_at":"2025-12-22T09:32:57.821318-06:00","labels":["high","phase-2","refactor","typing"],"dependencies":[{"issue_id":"crystalmath-d6t.7","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:23:21.414531-06:00","created_by":"briansquires"}],"comments":[{"id":8,"issue_id":"crystalmath-d6t.7","author":"briansquires","text":"TRANSFERRED to crystalmath-ae6.7 in new Runner Correctness \u0026 Data Safety Sprint epic. This issue is being consolidated with typing fixes identified in Codex deep code review.","created_at":"2025-12-22T15:32:31Z"}]}
{"id":"crystalmath-d6t.8","title":"Fix BaseRunner get_output() Stub","description":"Implement proper output streaming in runners.\n\n## Issue Reference\nHIGH-006\n\n## Files\n- tui/src/runners/base.py (line 298)\n- tui/src/runners/local_runner.py\n- tui/src/runners/ssh_runner.py\n- tui/src/runners/slurm_runner.py\n\n## Problem\nThe get_output() method has a stub implementation:\n```python\n# Line 298 in base.py\nasync def get_output(self, job_id: str) -\u003e AsyncGenerator[str, None]:\n    yield ''  # For type checker satisfaction\n```\n\n## Tasks\n- Make get_output() abstract method\n- Implement in LocalRunner (read stdout/stderr)\n- Implement in SSHRunner (stream via SFTP)\n- Implement in SLURMRunner (read slurm output files)\n- Add tests for output streaming","status":"closed","priority":1,"issue_type":"task","estimated_minutes":180,"created_at":"2025-12-10T07:23:29.356178-06:00","updated_at":"2025-12-22T09:32:52.740201-06:00","closed_at":"2025-12-22T09:32:52.740201-06:00","labels":["feature","high","phase-2","runners"],"dependencies":[{"issue_id":"crystalmath-d6t.8","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:23:29.357964-06:00","created_by":"briansquires"}],"comments":[{"id":7,"issue_id":"crystalmath-d6t.8","author":"briansquires","text":"TRANSFERRED to crystalmath-ae6.5 in new Runner Correctness \u0026 Data Safety Sprint epic. This issue is being consolidated with other runner contract work identified in Codex deep code review.","created_at":"2025-12-22T15:32:24Z"}]}
{"id":"crystalmath-d6t.9","title":"Fix Package Discovery","description":"Replace explicit package list with auto-discovery in pyproject.toml.\n\n## Issue Reference\nMED-001\n\n## Files\n- tui/pyproject.toml (lines 72-74)\n\n## Problem\nPackages are explicitly listed, missing src.tui.widgets:\n```toml\npackages = ['src', 'src.core', 'src.tui', 'src.tui.screens',\n            'src.runners', 'src.aiida', 'src.aiida.calcjobs',\n            'src.aiida.workchains', 'src.aiida.setup']\n```\n\n## Tasks\n- Replace with setuptools auto-discovery:\n  ```toml\n  [tool.setuptools.packages.find]\n  where = ['.']\n  ```\n- Test installation in fresh virtualenv\n- Verify all modules are included\n- Test editable install still works","status":"closed","priority":2,"issue_type":"task","estimated_minutes":90,"created_at":"2025-12-10T07:24:07.846344-06:00","updated_at":"2025-12-22T18:31:36.39458-06:00","closed_at":"2025-12-22T18:31:36.39458-06:00","labels":["config","medium","packaging","phase-3"],"dependencies":[{"issue_id":"crystalmath-d6t.9","depends_on_id":"crystalmath-d6t","type":"parent-child","created_at":"2025-12-10T07:24:07.847203-06:00","created_by":"briansquires"}],"comments":[{"id":23,"issue_id":"crystalmath-d6t.9","author":"briansquires","text":"Fixed by replacing explicit package list with setuptools auto-discovery. Now includes all packages: src.core.codes, src.core.codes.parsers, src.tui.widgets. Verified with uv pip install -e . and import tests.","created_at":"2025-12-23T00:14:25Z"}]}
{"id":"crystalmath-d9k","title":"Implement Queue Manager for job scheduling","description":"Create QueueManager class in src/core/queue.py for priority-based job queue.\n\nKey features:\n- Priority-based job queue\n- Automatic submission when resources available\n- Queue status monitoring\n- Configurable submission rate\n\nMain methods:\n- enqueue: Add job with priority\n- submit_next: Submit next job from queue\n- get_queue_status: Get current queue state\n- clear_queue: Empty the queue\n- pause/resume: Control automatic submission\n\nIntegration:\n- Background worker for automatic submission\n- Respect scheduler limits\n- Handle submission failures\n- Rate limiting between submissions\n\nTesting:\n- Test priority sorting\n- Test automatic submission\n- Test pause/resume functionality\n\nSee: tui/docs/PHASE2_DESIGN.md section 2.2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:29.845912-06:00","updated_at":"2025-11-21T06:59:18.731639-06:00","closed_at":"2025-11-21T06:59:18.731639-06:00","labels":["batch","core","phase-2"]}
{"id":"crystalmath-djc","title":"MEDIUM: Align tests with production app_enhanced.py entrypoint","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-22T19:09:07.118286-06:00","updated_at":"2025-12-22T19:09:07.118286-06:00"}
{"id":"crystalmath-dmt","title":"Write unit tests for lib/cry-stage.sh","description":"Test file staging, retrieval, missing file handling","acceptance_criteria":"- Test stage_inputs() copies files correctly\n- Test stage_retrieve_results()\n- Test missing file handling\n- Test explicit path usage\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.253695-06:00","updated_at":"2025-11-20T00:40:41.589542-06:00","closed_at":"2025-11-20T00:40:41.589542-06:00","dependencies":[{"issue_id":"crystalmath-dmt","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.402954-06:00","created_by":"daemon"}]}
{"id":"crystalmath-dpd","title":"Migrate to AiiDA VASP parsers - use aiida-vasp plugin parsers","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T18:52:08.356947-06:00","updated_at":"2025-12-22T18:52:08.356947-06:00"}
{"id":"crystalmath-drj","title":"Queue manager race conditions","description":"queue_manager.py:139-233,409-489 uses shared dicts without consistent locking. _scheduler_worker reads/writes _jobs while enqueue/dequeue hold lock separately.\n\nFix:\n- Add consistent locking around all _jobs/_clusters access\n- Avoid calling schedule_jobs outside lock\n- Batch DB queries instead of per-job SELECT each tick\n- Add lock ordering discipline\n- Test concurrent enqueue/dequeue scenarios\n- Add deadlock prevention\n\nIssues:\n- Race conditions on shared state\n- Lost updates from concurrent modifications\n- Poor scalability (DB query per job per tick)\n\nFiles: tui/src/core/queue_manager.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:18.009111-06:00","updated_at":"2025-11-23T14:38:48.712498-06:00","closed_at":"2025-11-23T14:38:48.712498-06:00","labels":["concurrency","phase-2","queue","reliability"]}
{"id":"crystalmath-ejy","title":"Implement module loader (cry_require)","description":"Create lib/core.sh with cry_require() function for safe module loading with error handling","design":"From codex: Check file exists before source, emit helpful errors for missing modules, return non-zero on failure. Allow main script to loop through module list","acceptance_criteria":"- cry_require() loads modules safely\n- Missing module errors are helpful\n- Returns appropriate exit codes\n- Works with module dependency order","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.740574-06:00","updated_at":"2025-11-19T20:52:31.893411-06:00","closed_at":"2025-11-19T20:52:31.893411-06:00","dependencies":[{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.597902-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.923232-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ejy","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.035547-06:00","created_by":"daemon"}]}
{"id":"crystalmath-fcq","title":"Extend database schema for remote jobs","description":"Add new tables to support remote execution and clusters.\n\nNew tables:\n- clusters: Store cluster connection information\n- remote_jobs: Link jobs to clusters and track scheduler IDs\n- Add cluster_id column to existing jobs table\n\nSchema changes:\n\n\nImplementation:\n- Add migration logic to Database class\n- Add CRUD methods for clusters\n- Add methods to link jobs to clusters\n- Handle backward compatibility\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.5","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:12.283543-06:00","updated_at":"2025-11-21T06:56:04.353603-06:00","closed_at":"2025-11-21T06:56:04.353603-06:00","labels":["database","phase-2","remote-execution"]}
{"id":"crystalmath-g1i","title":"Database migrations not transactional","description":"database.py:87-186 migration from v1 to v2 is not wrapped in a transaction. Partial failures are silently ignored, can leave half-applied schema.\n\nFix:\n- Wrap entire migration in explicit transaction\n- Verify schema after migration\n- Add rollback on any failure\n- Test migration failure scenarios\n- Add schema version validation\n- Backfill existing rows with FK consistency checks\n\nRisks:\n- Data corruption from partial schema updates\n- Foreign key constraint violations\n- Inconsistent database state after crash\n\nFiles: tui/src/core/database.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:17.033933-06:00","updated_at":"2025-11-23T14:38:55.032342-06:00","closed_at":"2025-11-23T14:38:55.032342-06:00","labels":["database","phase-2","reliability"]}
{"id":"crystalmath-g4p","title":"Create tutorial module system from MASTER_TUTORIAL.md","description":"Split MASTER_TUTORIAL.md into separate tutorial files matching V2 help menu: usage.md, parallelism.md, intel_opts.md, scratch.md, troubleshooting.md. Install to share/tutorials/","design":"Extract sections from MASTER_TUTORIAL.md using SECTION markers. Create 5 markdown files in share/tutorials/. Update help_show_main() to use show_tutorial() function (like V2:94-108) that displays files with gum pager --soft-wrap.","acceptance_criteria":"- 5 tutorial files created\n- Matches V2 menu structure\n- Markdown formatting preserved\n- help_show_main updated\n- Tutorials display correctly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T23:00:50.061432-06:00","updated_at":"2025-11-19T23:55:25.054325-06:00","closed_at":"2025-11-19T23:55:25.054325-06:00","dependencies":[{"issue_id":"crystalmath-g4p","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.832772-06:00","created_by":"daemon"}]}
{"id":"crystalmath-hai","title":"Enhance Job Status Display","description":"Improve job list table with better status indicators. Add color-coded status (green=completed, red=failed, yellow=running), progress indicators for running jobs, timestamps for created/started/completed, and sortable columns.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:27.245956-06:00","updated_at":"2025-11-20T23:25:04.940838-06:00","closed_at":"2025-11-20T23:25:04.940838-06:00","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-hyl","title":"Implement lib/cry-scratch.sh","description":"Scratch space lifecycle management. Functions: scratch_create(file_prefix) creates unique dir in SCRATCH_BASE, exports WORK_DIR. scratch_cleanup() removes scratch dir idempotently","design":"From gemini: Use trap 'scratch_cleanup' EXIT in main script. Safe to call cleanup even if creation failed. From codex: Return 70 for validation failures","acceptance_criteria":"- scratch_create() generates unique directories\n- WORK_DIR exported correctly\n- scratch_cleanup() is idempotent\n- Works with trap mechanism","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.849221-06:00","updated_at":"2025-11-19T20:55:33.203349-06:00","closed_at":"2025-11-19T20:55:33.203349-06:00","dependencies":[{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.99272-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-pc3","type":"blocks","created_at":"2025-11-19T20:36:50.294435-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.501139-06:00","created_by":"daemon"},{"issue_id":"crystalmath-hyl","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.108019-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ib2","title":"Implement lib/cry-stage.sh","description":"File staging utilities. Functions: stage_inputs(file_prefix, work_dir, original_dir) copies input/aux files to scratch. stage_retrieve_results() copies outputs back","design":"From gemini: Move file mapping from lines 295-301, 361-367 to cry-config as associative arrays STAGE_MAP, RETRIEVE_MAP. Functions accept explicit dir arguments instead of relying on pwd","acceptance_criteria":"- stage_inputs() copies all required files\n- stage_retrieve_results() retrieves outputs\n- Uses explicit path arguments\n- Handles missing files gracefully","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.884651-06:00","updated_at":"2025-11-19T20:55:39.606558-06:00","closed_at":"2025-11-19T20:55:39.606558-06:00","dependencies":[{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.017047-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-dmt","type":"blocks","created_at":"2025-11-19T20:36:50.340079-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.524587-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ib2","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.135967-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ikl","title":"Create project directory structure","description":"Create bin/, lib/, tests/, docs/ directories. Set up initial .gitignore","acceptance_criteria":"- Directories created\n- .gitignore includes tmp_crystal/, .beads/ backup files\n- README.md updated with new structure","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.625726-06:00","updated_at":"2025-11-19T20:46:28.005003-06:00","closed_at":"2025-11-19T20:46:28.005003-06:00","dependencies":[{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-6sp","type":"blocks","created_at":"2025-11-19T20:36:49.480865-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-lcc","type":"blocks","created_at":"2025-11-19T20:36:49.506133-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.528672-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-7jf","type":"blocks","created_at":"2025-11-19T20:36:50.109912-06:00","created_by":"daemon"},{"issue_id":"crystalmath-ikl","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:06.961671-06:00","created_by":"daemon"}]}
{"id":"crystalmath-jmt","title":"Integrate cry23.bashrc Environment","description":"Connect to existing CRYSTAL23 environment configuration. Source cry23.bashrc for environment variables, use CRY23_EXEDIR for executable path, respect CRY23_SCRDIR for scratch directory, handle missing environment gracefully.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T19:20:26.142779-06:00","updated_at":"2025-11-20T23:24:24.808242-06:00","closed_at":"2025-11-20T23:24:24.808242-06:00","labels":["integration","mvp","phase-1"]}
{"id":"crystalmath-lac","title":"Duplicate dependency resolution logic","description":"Orchestrator and QueueManager both implement dependency resolution and state tracking independently. Orchestrator has _validate_dag/_dependencies_met while QueueManager has _validate_dependencies/_dependencies_satisfied.\n\nFix:\n- Consolidate DAG validation into single layer (QueueManager)\n- Have Orchestrator call QueueManager's dependency logic\n- Extract shared dependency graph utilities\n- Define single source of truth for job lifecycle\n- Add comprehensive dependency resolution tests\n\nImpact: Divergent rules, duplicated work, harder to reason about correctness, risk of inconsistent behavior.\n\nFiles:\n- tui/src/core/orchestrator.py (DAG validation)\n- tui/src/core/queue_manager.py (dependency checking)\n\nRecommendation: Create shared workflow/dependency.py module with unified logic.\n\nDependencies: Consider crystalmath-8gv (Workflow DAG) refactoring.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-21T12:15:16.479008-06:00","updated_at":"2025-11-22T23:47:15.899249-06:00","closed_at":"2025-11-22T23:47:15.899249-06:00","labels":["architecture","orchestration","phase-2","queue"]}
{"id":"crystalmath-lcc","title":"Implement lib/cry-logging.sh","description":"Logging infrastructure with cry_log(), cry_fatal(), cry_warn() functions. Structured output for debugging","design":"From codex: cry_fatal() returns exit code, doesn't call exit. cry_log levels: debug, info, warn, error. Support CRY_LOG_LEVEL env var","acceptance_criteria":"- cry_log() function works with levels\n- cry_fatal() returns non-zero\n- Log output includes timestamps\n- Respects log level filtering","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.702964-06:00","updated_at":"2025-11-19T20:50:22.965951-06:00","closed_at":"2025-11-19T20:50:22.965951-06:00","dependencies":[{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-ejy","type":"blocks","created_at":"2025-11-19T20:36:49.574097-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-be3","type":"blocks","created_at":"2025-11-19T20:36:49.644519-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:49.900194-06:00","created_by":"daemon"},{"issue_id":"crystalmath-lcc","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.01077-06:00","created_by":"daemon"}]}
{"id":"crystalmath-nim","title":"Write unit tests for lib/cry-config.sh","description":"Test configuration initialization, env var overrides, path construction, cry_config_get()","acceptance_criteria":"- Test cry_config_init() \n- Test env var override behavior\n- Test path variable exports\n- Test cry_config_get() helper\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.098633-06:00","updated_at":"2025-11-20T00:40:36.148444-06:00","closed_at":"2025-11-20T00:40:36.148444-06:00","dependencies":[{"issue_id":"crystalmath-nim","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.284252-06:00","created_by":"daemon"}]}
{"id":"crystalmath-oxy","title":"Refactor runcrystal into modular architecture","description":"Transform monolithic 372-line runcrystal script into production-grade modular CLI tool with separate lib/ modules, shared UI components, and comprehensive testing","design":"Architecture based on gemini/codex analysis: cry-config, cry-ui, cry-parallel, cry-scratch, cry-stage, cry-exec, cry-help modules. Main script becomes thin orchestrator \u003c100 lines. Use CRY_JOB associative array for state passing. Implement trap-based cleanup guarantee.","acceptance_criteria":"- All modules created and tested independently\n- Main runcrystal script \u003c100 lines\n- Zero functionality regression\n- Test coverage \u003e80%\n- Documentation complete\n- cry-docs can reuse UI components","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-11-19T20:35:09.537435-06:00","updated_at":"2025-11-20T00:40:56.402673-06:00","closed_at":"2025-11-20T00:40:56.402673-06:00"}
{"id":"crystalmath-pc3","title":"Write unit tests for lib/cry-scratch.sh","description":"Test scratch creation, cleanup, idempotency, trap integration","acceptance_criteria":"- Test scratch_create() unique dirs\n- Test scratch_cleanup() idempotent\n- Test cleanup on error conditions\n- Verify no orphaned directories\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.218728-06:00","updated_at":"2025-11-20T00:40:41.58912-06:00","closed_at":"2025-11-20T00:40:41.58912-06:00","dependencies":[{"issue_id":"crystalmath-pc3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.375628-06:00","created_by":"daemon"}]}
{"id":"crystalmath-poz","title":"Template path traversal vulnerability","description":"templates.py:237-307 TemplateManager loads arbitrary paths without restricting to template_dir. Combined with unsandboxed Jinja = file read vulnerability.\n\nFix:\n- Validate all template paths are under template_dir\n- Use Path.resolve() and check parent\n- Reject paths with .. or absolute paths\n- Add path validation tests\n- Document template security model\n\nImpact: Path traversal can read arbitrary YAML files, combined with unsandboxed Jinja enables code execution.\n\nFiles: tui/src/core/templates.py\n\nDependencies: Blocked by crystalmath-4x8 (Jinja sandbox)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:22.913047-06:00","updated_at":"2025-11-22T23:47:15.898908-06:00","closed_at":"2025-11-22T23:47:15.898908-06:00","labels":["phase-2","security","templates"]}
{"id":"crystalmath-pq3","title":"Write unit tests for lib/cry-ui.sh","description":"Test UI functions with and without gum, theme system, graceful degradation","acceptance_criteria":"- Test ui_banner(), ui_card(), ui_status_line()\n- Test with HAS_GUM=true and false\n- Test theme system\n- Verify graceful degradation\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.139819-06:00","updated_at":"2025-11-20T00:40:41.588066-06:00","closed_at":"2025-11-20T00:40:41.588066-06:00","dependencies":[{"issue_id":"crystalmath-pq3","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.308856-06:00","created_by":"daemon"}]}
{"id":"crystalmath-ps0","title":"Create developer documentation (CONTRIBUTING.md)","description":"Document: how to add new modules, testing requirements, code style, module conventions","acceptance_criteria":"- CONTRIBUTING.md created\n- Module creation guide included\n- Testing requirements clear\n- Code style documented","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-19T20:36:19.434779-06:00","updated_at":"2025-11-19T21:09:36.094457-06:00","closed_at":"2025-11-19T21:09:36.094457-06:00","dependencies":[{"issue_id":"crystalmath-ps0","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.527853-06:00","created_by":"daemon"}]}
{"id":"crystalmath-qt1","title":"Implement New Job Modal Screen","description":"Create modal screen for job creation with input editor. Include TextArea widget for .d12 input content, Input field for job name, validation before job creation, and write input.d12 to work directory.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-20T19:20:24.783967-06:00","updated_at":"2025-11-20T23:25:50.486124-06:00","closed_at":"2025-11-20T23:25:50.486124-06:00","labels":["mvp","phase-1","ui"]}
{"id":"crystalmath-r7z","title":"Connection manager cleanup issues","description":"connection_manager.py:201-245 health check loop may not stop cleanly after stop() unless task cancelled. Stale pooled connections outlive application lifecycle.\n\nFix:\n- Ensure health check task stops on manager.stop()\n- Add explicit connection cleanup on shutdown\n- Set connection timeouts and max idle time\n- Add connection leak detection\n- Implement graceful degradation on health check failures\n- Test lifecycle management\n\nIssues:\n- Health check loop continues after stop()\n- Stale connections not cleaned up\n- Resource leaks on application shutdown\n\nFiles: tui/src/core/connection_manager.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T08:08:19.109654-06:00","updated_at":"2025-11-23T02:14:09.742176-06:00","closed_at":"2025-11-23T02:14:09.742176-06:00","labels":["phase-2","reliability","remote-execution"]}
{"id":"crystalmath-rfj","title":"CRITICAL: Orchestrator doesn't submit jobs to runners","description":"orchestrator.py:196-230,298-343 has TODO in _submit_node - never actually calls queue manager or runners. Workflows report success without executing anything.\n\nFix:\n- Implement _submit_node to call queue_manager.enqueue()\n- Wire runner callbacks to update workflow state\n- Ensure atomic DB updates for job/workflow status\n- Add orchestrator-to-runner integration tests\n- Cleanup /tmp/workflow_* directories on completion\n- Add proper error handling and retry logic\n\nImpact: SHOWSTOPPER - workflows don't run, report false success.\n\nFiles: tui/src/core/orchestrator.py","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:49.524286-06:00","updated_at":"2025-11-21T14:27:24.07948-06:00","closed_at":"2025-11-21T14:27:24.07948-06:00","labels":["critical","orchestration","phase-2","workflow"],"comments":[{"id":2,"issue_id":"crystalmath-rfj","author":"briansquires","text":"Agent 5 implementation: NEEDS_WORK (52% confidence)\n\n✅ COMPLETED: \n- _submit_node() method implemented (85 lines)\n- _on_node_complete() callback handler created\n- Callback tracking infrastructure added (_node_callbacks dict)\n- 9 integration tests passing\n\n❌ REMAINING ISSUE: Callbacks NOT wired to queue manager or runner completion events (lines 720-768)\n\nCRITICAL: Workflows will STALL after first node submission. The _on_node_complete() method is defined but NEVER CALLED.\n\nREQUIRED FIX: Wire orchestrator to receive job status change events from queue/runner.\n\nOptions:\n1. Add callback registration in queue_manager.py when job completes\n2. Add polling mechanism to check job completion  \n3. Implement event bus for job status changes\n\nFile: tui/src/core/orchestrator.py\nCodex review: See CODE_QUALITY_REVIEW.md - Agent 5 section\n","created_at":"2025-11-21T19:03:28Z"}]}
{"id":"crystalmath-rzw","title":"Write unit tests for lib/cry-parallel.sh","description":"Test resource calculation, env var exports, CRY_JOB array population","acceptance_criteria":"- Test serial mode (nprocs=0)\n- Test hybrid mode (various nprocs)\n- Test thread calculation\n- Test env var exports\n- All tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.179675-06:00","updated_at":"2025-11-20T00:40:41.588656-06:00","closed_at":"2025-11-20T00:40:41.588656-06:00","dependencies":[{"issue_id":"crystalmath-rzw","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.336708-06:00","created_by":"daemon"}]}
{"id":"crystalmath-skp","title":"LOW: Address FIX comments in queue_manager.py (lines 261, 271, 943, 1128)","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T19:09:19.615572-06:00","updated_at":"2025-12-22T19:09:19.615572-06:00"}
{"id":"crystalmath-sro","title":"Implement SSH Runner for remote execution","description":"Create SSHRunner class in src/runners/ssh.py using asyncssh.\n\nKey features:\n- Connection pooling (reuse SSH connections)\n- Async file transfer via SFTP\n- Real-time stdout/stderr streaming\n- Remote process monitoring\n- Error handling and retry logic\n\nImplementation:\n- Extends BaseRunner abstract interface\n- Uses asyncssh (not paramiko) for async operations\n- Implements _get_connection() for connection pooling\n- Implements _transfer_files() for SFTP uploads\n- Implements run_job() with streaming output\n\nDependencies:\n- pip install asyncssh\n- BaseRunner interface must be defined\n\nTesting:\n- Mock asyncssh connections\n- Test file transfer\n- Test process execution\n- Test error handling\n\nSee: tui/docs/PHASE2_DESIGN.md section 1.2","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-20T23:24:08.062949-06:00","updated_at":"2025-11-21T06:59:41.751892-06:00","closed_at":"2025-11-21T06:59:41.751892-06:00","labels":["core","phase-2","remote-execution"]}
{"id":"crystalmath-t20","title":"SECURITY: Escape SLURM script generation","description":"slurm_runner.py:189-275 embeds unescaped user fields in SLURM scripts (job_name, partition, env, modules). No validation of crystal binary path.\n\nFix:\n- Escape/quote all user-supplied fields in SBATCH directives\n- Validate job_name, partition names (alphanumeric only)\n- Validate module names and environment variables\n- Verify crystal executable exists and is valid binary\n- Use shlex.quote for all script interpolation\n- Add SLURM injection tests\n\nVulnerable fields:\n- #SBATCH --job-name={job_name}\n- #SBATCH --partition={partition}\n- module load {modules}\n- {env_vars}\n\nImpact: Command injection in HPC batch submission.\n\nFiles: tui/src/runners/slurm_runner.py","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-21T08:07:48.316042-06:00","updated_at":"2025-11-21T13:02:42.248498-06:00","closed_at":"2025-11-21T13:02:42.248498-06:00","labels":["critical","phase-2","remote-execution","security","slurm"]}
{"id":"crystalmath-tai","title":"TUI Architecture Realignment - Wire production app to QueueManager/Orchestrator","description":"","status":"open","priority":0,"issue_type":"epic","created_at":"2025-12-22T19:08:10.602025-06:00","updated_at":"2025-12-22T19:08:10.602025-06:00"}
{"id":"crystalmath-v9i","title":"[epic] Quantum Espresso \u0026 VASP Implementation","description":"Full implementation of Quantum Espresso and VASP support in the TUI. Builds on existing stubs in src/core/codes/.\n\n## Goals\n- Complete QE and VASP output parsing\n- Multi-file input handling (VASP: INCAR/POSCAR/KPOINTS/POTCAR)\n- Input templates for common calculation types\n- Workflow support (relaxation, DOS, bands)\n- Integration with existing runners (local, SSH, SLURM)\n\n## Prerequisites\n- DFT-agnostic architecture (crystalmath-7yd) ✅\n- Runner correctness (crystalmath-ae6) ✅\n- Phase 4 stubs (crystalmath-7yd.5) ✅\n\n## Phases\n1. Output Parsers - Extract energy, forces, stress, convergence\n2. Input Handling - Multi-file support, template generation\n3. Workflows - Relaxation chains, DOS/bands post-processing\n4. Testing - Integration tests with sample calculations","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T18:10:49.339451-06:00","updated_at":"2025-12-22T18:53:52.36296-06:00","closed_at":"2025-12-22T18:53:52.36296-06:00","labels":["dft-codes","phase-4","qe","vasp"]}
{"id":"crystalmath-v9i.1","title":"[task] Implement Quantum Espresso output parser","description":"Parse QE pw.x output for:\n- Total energy (Ry and eV)\n- Forces on atoms\n- Stress tensor\n- Convergence status\n- k-point information\n- Band energies (if available)\n\nFiles: src/core/codes/parsers/qe.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T18:11:25.592319-06:00","updated_at":"2025-12-22T18:35:28.12481-06:00","closed_at":"2025-12-22T18:35:28.12481-06:00","labels":["parser","phase-4","qe"],"dependencies":[{"issue_id":"crystalmath-v9i.1","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:25.593741-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.2","title":"[task] Implement VASP output parser","description":"Parse VASP OUTCAR and vasprun.xml for:\n- Total energy (eV)\n- Forces on atoms  \n- Stress tensor\n- Convergence status (ionic + electronic)\n- Band structure data\n- DOS data\n\nFiles: src/core/codes/parsers/vasp.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T18:11:32.077695-06:00","updated_at":"2025-12-22T18:35:28.126296-06:00","closed_at":"2025-12-22T18:35:28.126296-06:00","labels":["parser","phase-4","vasp"],"dependencies":[{"issue_id":"crystalmath-v9i.2","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:32.078711-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.3","title":"[task] Implement VASP multi-file input handling","description":"VASP requires multiple input files (INCAR, POSCAR, KPOINTS, POTCAR). Implement:\n- Multi-file staging to work directory\n- POTCAR assembly from element list\n- Validation of required files\n- Template system for INCAR generation\n\nUpdate: src/core/codes/vasp.py, src/runners/*.py","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T18:11:38.504756-06:00","updated_at":"2025-12-22T18:38:59.272238-06:00","closed_at":"2025-12-22T18:38:59.272238-06:00","labels":["input","phase-4","vasp"],"dependencies":[{"issue_id":"crystalmath-v9i.3","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:38.505629-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.4","title":"[task] Create QE input templates","description":"Create Jinja2 templates for common QE calculations:\n- SCF (scf.in.j2)\n- Relaxation (relax.in.j2, vc-relax.in.j2)\n- Bands (bands.in.j2)\n- DOS (nscf.in.j2, dos.in.j2)\n- Phonons (ph.in.j2)\n\nLocation: tui/templates/qe/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:11:44.698525-06:00","updated_at":"2025-12-22T18:42:02.687783-06:00","closed_at":"2025-12-22T18:42:02.687783-06:00","labels":["phase-4","qe","templates"],"dependencies":[{"issue_id":"crystalmath-v9i.4","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:44.699313-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.5","title":"[task] Create VASP input templates","description":"Create Jinja2 templates for common VASP calculations:\n- SCF (INCAR_scf.j2)\n- Relaxation (INCAR_relax.j2)\n- Bands (INCAR_bands.j2)\n- DOS (INCAR_dos.j2)\n- Hybrid functionals (INCAR_hse.j2)\n\nLocation: tui/templates/vasp/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:11:51.963878-06:00","updated_at":"2025-12-22T18:42:02.688703-06:00","closed_at":"2025-12-22T18:42:02.688703-06:00","labels":["phase-4","templates","vasp"],"dependencies":[{"issue_id":"crystalmath-v9i.5","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:51.9647-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.6","title":"[task] Implement QE/VASP workflow chains","description":"Implement multi-step workflow support:\n\nQE Workflows:\n- relax → bands → dos\n- vc-relax → scf → phonons\n\nVASP Workflows:  \n- ISIF=3 relax → static → bands/dos\n- convergence testing (ENCUT, KPOINTS)\n\nUpdate: src/core/workflow.py, src/core/orchestrator.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:11:58.782926-06:00","updated_at":"2025-12-22T18:44:42.691876-06:00","closed_at":"2025-12-22T18:44:42.691876-06:00","labels":["phase-4","qe","vasp","workflow"],"dependencies":[{"issue_id":"crystalmath-v9i.6","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:11:58.783705-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.7","title":"[task] Add QE/VASP integration tests","description":"Create integration tests with sample calculations:\n- Parse real QE/VASP output files\n- Test multi-file staging\n- Test workflow execution (mock runners)\n- Test template rendering\n\nLocation: tui/tests/test_codes_*.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:12:05.748922-06:00","updated_at":"2025-12-22T18:38:59.273793-06:00","closed_at":"2025-12-22T18:38:59.273793-06:00","labels":["phase-4","qe","testing","vasp"],"dependencies":[{"issue_id":"crystalmath-v9i.7","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:12:05.749646-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.8","title":"[task] Cross-validate QE/VASP epic with Codex/Gemini","description":"After implementation tasks complete, validate with external AI review.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:12:12.290782-06:00","updated_at":"2025-12-22T18:53:34.88458-06:00","closed_at":"2025-12-22T18:53:34.88458-06:00","labels":["blocked","quality","validation"],"dependencies":[{"issue_id":"crystalmath-v9i.8","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:12:12.291524-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-v9i.9","title":"[task] Update documentation for QE/VASP support","description":"Update CLAUDE.md, GEMINI.md, and create user guide for QE/VASP workflows.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T18:12:18.692807-06:00","updated_at":"2025-12-22T18:53:45.873985-06:00","closed_at":"2025-12-22T18:53:45.873985-06:00","labels":["blocked","documentation"],"dependencies":[{"issue_id":"crystalmath-v9i.9","depends_on_id":"crystalmath-v9i","type":"parent-child","created_at":"2025-12-22T18:12:18.693647-06:00","created_by":"briansquires"}]}
{"id":"crystalmath-vw3","title":"HIGH: Fix JobResult type mismatch - run_job yields object but handler expects string","description":"","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-22T19:08:33.387745-06:00","updated_at":"2025-12-22T19:16:49.923477-06:00","closed_at":"2025-12-22T19:16:49.923477-06:00"}
{"id":"crystalmath-w1w","title":"Debounce/Coalesce Refresh Triggers","description":"Avoid repeated sorts/updates during burst refresh triggers. When multiple status updates arrive rapidly, coalesce them into a single refresh operation to prevent UI jitter and unnecessary redraws.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T14:30:50.674779-06:00","updated_at":"2025-12-17T14:30:50.674779-06:00"}
{"id":"crystalmath-wco","title":"Migrate to AiiDA QE parsers - Replace custom QEParser with aiida-quantumespresso parsers when AiiDA integration is active. The aiida-quantumespresso plugin provides production-tested PwParser with comprehensive error handling, support for all QE output formats, and automatic data provenance tracking.","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T18:51:55.047578-06:00","updated_at":"2025-12-22T18:51:55.047578-06:00"}
{"id":"crystalmath-wil","title":"Implement automatic error analysis system","description":"Add intelligent failure analysis that scans output logs for common CRYSTAL23 errors (SCF divergence, memory issues) and provides student-friendly diagnostic hints and solutions.","design":"From V2/CrystalRun:280-308. Create analyze_failure() function in cry-exec.sh. Patterns: 'DIVERGENCE' → SCF hints, 'insufficient memory'/'SIGSEGV' → memory hints. Display with ui_warning and show last 20 lines of log. Call from exec_crystal_run on non-zero exit.","acceptance_criteria":"- Detects SCF divergence\n- Detects memory errors\n- Provides actionable hints\n- Shows log tail (20 lines)\n- Integrates with cry-exec","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-19T23:00:48.95185-06:00","updated_at":"2025-11-19T23:55:18.477878-06:00","closed_at":"2025-11-19T23:55:18.477878-06:00","dependencies":[{"issue_id":"crystalmath-wil","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T23:00:56.806109-06:00","created_by":"daemon"}]}
{"id":"crystalmath-wjy","title":"Add strict mode to all bash modules","description":"Only cli/lib/core.sh sets 'set -euo pipefail'. Other modules (cry-parallel.sh:1-15, cry-scratch.sh, cry-stage.sh) rely on caller for error flags.\n\nFix:\n- Add guard header to each module:\n  [[ ${_CRY_MODULE_LOADED:-0} -eq 1 ]] \u0026\u0026 return\n  set -euo pipefail\n  readonly _CRY_MODULE_LOADED=1\n\n- Ensure IFS is set appropriately\n- Add shellcheck directives for module-specific needs\n- Test modules can be sourced directly\n- Document strict mode expectations\n\nImpact: Silent failures when modules sourced directly or from future entrypoints.\n\nAffected modules:\n- cli/lib/cry-parallel.sh\n- cli/lib/cry-scratch.sh\n- cli/lib/cry-stage.sh\n- cli/lib/cry-exec.sh\n- cli/lib/cry-help.sh\n- cli/lib/cry-ui.sh\n\nFiles: cli/lib/*.sh (except core.sh which already has it)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-21T12:15:52.24898-06:00","updated_at":"2025-11-23T14:59:42.692703-06:00","closed_at":"2025-11-23T14:59:42.692703-06:00","labels":["bash","cli","reliability"]}
{"id":"crystalmath-wlb","title":"[enhancement] Remote runner concurrency should limit active jobs, not just submissions","description":"Currently SSHRunner and SLURMRunner release the semaphore after submission, not job completion. This means max_concurrent_jobs throttles submission rate but doesn't limit active running jobs. Fix requires QueueManager to track active job count or a background monitor. Transferred from crystalmath-ae6.12.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-22T10:17:30.641361-06:00","updated_at":"2025-12-22T10:17:30.641361-06:00","labels":["P2","enhancement","phase4"]}
{"id":"crystalmath-wwa","title":"Implement lib/cry-help.sh","description":"Help system module. Function: help_show_main() displays interactive menu. Preserves existing help content from runcrystal:120-224","design":"Extract help system to module. Keep gum choose and gum pager logic. Prepare integration point for cry-docs (line 214-219 logic)","acceptance_criteria":"- help_show_main() displays menu\n- All help topics preserved\n- gum integration works\n- Placeholder for cry-docs integration ready","status":"closed","priority":0,"issue_type":"task","created_at":"2025-11-19T20:36:18.953841-06:00","updated_at":"2025-11-19T20:55:19.451921-06:00","closed_at":"2025-11-19T20:55:19.451921-06:00","dependencies":[{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-6vn","type":"blocks","created_at":"2025-11-19T20:36:50.063318-06:00","created_by":"daemon"},{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-7e1","type":"blocks","created_at":"2025-11-19T20:36:50.571175-06:00","created_by":"daemon"},{"issue_id":"crystalmath-wwa","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.188014-06:00","created_by":"daemon"}]}
{"id":"crystalmath-x7l","title":"Create Results Summary View","description":"Parse and display structured results in Results tab. Show final energy display, geometry information, key calculation parameters, and error messages if failed.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T19:20:30.439808-06:00","updated_at":"2025-11-20T23:26:19.800396-06:00","closed_at":"2025-11-20T23:26:19.800396-06:00","labels":["mvp","phase-1","results"]}
{"id":"crystalmath-xev","title":"Implement Batch Job Submission UI","description":"Create BatchSubmitScreen in src/tui/screens/batch_submit.py.\n\nFeatures:\n- Multi-select in job list (Shift+Arrow, Space)\n- Batch actions: Submit All, Stop All, Delete All\n- Progress indicator (N/M jobs processed)\n- Automatic delay between submissions\n\nUI components:\n- DataTable with selectable rows\n- Action buttons (Submit, Stop, Delete)\n- Progress bar\n- Status messages\n\nImplementation:\n- Track selected jobs with set\n- Handle keyboard shortcuts\n- Use Textual Worker for async submission\n- Rate limit submissions (2-5 second delay)\n\nSee: tui/docs/PHASE2_DESIGN.md section 2.1","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-20T23:24:14.084737-06:00","updated_at":"2025-11-21T06:53:25.687449-06:00","closed_at":"2025-11-21T06:53:25.687449-06:00","labels":["batch","phase-2","ui"]}
{"id":"crystalmath-xjk","title":"Complete Core Job Runner","description":"Implement real CRYSTAL job execution with CRYSTALpytools integration. Replace mock subprocess with actual crystalOMP execution. Parse output files for energy and results. Detect errors and convergence. Store structured results in database.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-20T19:20:23.494592-06:00","updated_at":"2025-11-23T15:05:18.844244-06:00","closed_at":"2025-11-23T15:05:18.844244-06:00","labels":["core","mvp","phase-1"]}
{"id":"crystalmath-z00","title":"Write integration tests","description":"End-to-end workflow tests with mocked CRYSTAL23 binaries","design":"From codex: Set CRY_FAKE_BIN=true, create fake crystalOMP/PcrystalOMP that exit 0, verify full workflow: parse args → setup → stage → exec → retrieve → cleanup","acceptance_criteria":"- Smoke test with serial mode\n- Smoke test with parallel mode\n- Test failure handling\n- Test scratch cleanup on error\n- All integration tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-19T20:36:19.288627-06:00","updated_at":"2025-11-20T23:27:47.04236-06:00","closed_at":"2025-11-20T23:27:47.04236-06:00","dependencies":[{"issue_id":"crystalmath-z00","depends_on_id":"crystalmath-oxy","type":"parent-child","created_at":"2025-11-19T20:37:07.427689-06:00","created_by":"daemon"}]}
{"id":"crystalmath-z2i","title":"Orchestrator hardcodes /tmp for workflow dirs","description":"orchestrator.py:553-560 hardcodes workflow directories to /tmp/workflow_*, ignoring CRY23_SCRDIR/CRY_SCRATCH_BASE environment variables. Causes orphaned files, clashes on shared hosts, violates configuration guidelines.\n\nFix:\n- Inject scratch base from environment/config\n- Use CRY_SCRATCH_BASE or CRY23_SCRDIR if set\n- Register cleanup handlers for workflow completion/failure\n- Create unique timestamped directories\n- Add configurable retention policy\n\nImpact: Orphaned files in /tmp, directory name clashes on shared systems, violates scratch directory conventions.\n\nBefore:\nwork_dir = Path(f'/tmp/workflow_{workflow_id}_node_{node.node_id}')\n\nAfter:\nscratch_base = Path(os.environ.get('CRY_SCRATCH_BASE', tempfile.gettempdir()))\nwork_dir = scratch_base / f'workflow_{workflow_id}_node_{node.node_id}_{timestamp}'\n# Register cleanup on completion\n\nFiles: tui/src/core/orchestrator.py","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-21T12:14:05.320926-06:00","updated_at":"2025-11-21T13:02:47.902798-06:00","closed_at":"2025-11-21T13:02:47.902798-06:00","labels":["configuration","orchestration","phase-2"]}
