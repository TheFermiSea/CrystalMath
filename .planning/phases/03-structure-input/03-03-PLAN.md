# Plan 03-03: Structure Preview UI

## Goal
Add a structure preview panel to the Materials modal that shows formula, lattice parameters, and atom count when a structure is selected.

## Context
- Materials modal already shows search results in a table
- StructurePreview model exists in models.rs
- Python has `structures.preview` RPC handler
- Need to fetch and display preview when user selects a material

## Tasks

### 1. Add Preview State to MaterialsSearchState
**File**: `src/state/mod.rs`

- Add `preview: Option<StructurePreview>` field
- Add `preview_loading: bool` field
- Add `preview_request_id: usize` field

### 2. Add Preview Request Method
**File**: `src/app.rs`

- Add `request_structure_preview()` method
- Call when material selection changes
- Use JSON-RPC to call `structures.preview`

### 3. Handle Preview Response
**File**: `src/app.rs`

- Add handler in RpcResult for preview responses
- Parse `ApiResponse<StructurePreview>`
- Store in materials.preview

### 4. Update Materials Modal UI
**File**: `src/ui/materials.rs`

- Split modal into two columns: results table + preview panel
- Preview panel shows:
  - Formula (large)
  - Space group (if available)
  - Lattice: a, b, c (Å) / α, β, γ (°)
  - Volume (Å³)
  - Atoms: count
  - Elements: species list
- Show "Select a structure" when no selection
- Show "Loading..." during preview fetch

### 5. Trigger Preview on Selection Change
**File**: `src/main.rs`

- After select_next/select_prev in materials modal
- Call request_structure_preview()

## Success Criteria
- [ ] Preview panel renders in materials modal
- [ ] Selecting a material triggers preview fetch
- [ ] Preview shows formula, lattice, atoms
- [ ] Loading state displayed during fetch
- [ ] Error state handled gracefully

## Technical Notes
- Use constraint layout: 60% table, 40% preview
- Lattice params formatted to 4 decimal places
- Volume formatted to 2 decimal places
- Species as comma-separated list
