# Plan 03-04: VASP Configuration Form & Integration Tests

## Goal
Add a configuration form for VASP generation parameters and write integration tests for the complete Phase 3 functionality.

## Context
- VASP generation works with default config (preset=relax, kppra=1000)
- Users need to adjust preset and k-point density before generating
- Need integration tests to verify the full Materials → VASP → Editor flow

## Tasks

### 1. Add VASP Config Panel to Materials Modal
**File**: `src/ui/materials.rs`

- Add config section below preview panel or as separate tab
- Show current preset with options to change
- Show kppra slider/input (500, 1000, 2000)
- Optional: ENCUT override field

### 2. Add Keybindings for Config Changes
**File**: `src/main.rs`

- 'p' to cycle through presets (relax → static → bands → dos → convergence)
- 'k' to cycle k-point density (500 → 1000 → 2000 → 500)

### 3. Integration Tests
**File**: `tests/vasp_integration.rs` (new)

Test cases:
- `test_vasp_generate_from_mp_returns_valid_inputs`
- `test_vasp_generate_with_preset_static`
- `test_vasp_generate_with_preset_relax`
- `test_structure_preview_returns_valid_data`
- `test_structures_import_poscar`

### 4. Update Documentation
- Update CLAUDE.md with new keybindings
- Update STATE.md with Phase 3 completion status

## Success Criteria
- [ ] Config panel shows current preset and kppra
- [ ] Keybindings allow changing config
- [ ] Integration tests pass
- [ ] Phase 3 deliverables complete

## Technical Notes
- Keep config simple for v1 (preset + kppra only)
- ENCUT override can be deferred to future enhancement
- Tests require pymatgen to be installed
