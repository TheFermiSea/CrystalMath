name: "Optimization + Frequency"
version: "1.0"
description: "Complete workflow: geometry optimization followed by frequency calculation"
author: "CRYSTAL Team"
tags: ["workflow", "optimization", "frequency", "phonon"]

parameters:
  shrink:
    type: integer
    description: "k-point shrinking factor"
    default: 8
    min: 2
    max: 16
    required: true

  max_opt_cycles:
    type: integer
    description: "Maximum optimization cycles"
    default: 100
    min: 10
    max: 500
    required: false

  convergence:
    type: float
    description: "SCF convergence threshold"
    default: 1.0e-8
    min: 1.0e-12
    max: 1.0e-6
    required: true

  freq_restart:
    type: boolean
    description: "Restart frequency calculation if available"
    default: false

input_template: |
  Optimization + Frequency Workflow
  EXTERNAL
  OPTGEOM
  FULLOPTG
  {% if max_opt_cycles %}
  MAXCYCLE
  {{ max_opt_cycles }}
  {% endif %}
  END
  END
  SHRINK
  {{ shrink }} {{ shrink }}
  TOLINTEG
  7 7 7 7 14
  TOLDEE
  {{ convergence }}
  END
  FREQCALC
  {% if freq_restart %}
  RESTART
  {% endif %}
  END

metadata:
  calculation_type: "workflow"
  steps: ["optimization", "frequency"]
  complexity: "workflow"
