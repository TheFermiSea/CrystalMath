name: "YAMBO GW Quasiparticle"
version: "1.0"
description: "GW quasiparticle corrections for accurate band gaps"
author: "Crystal-TUI Team"
dft_code: "yambo"
tags: ["yambo", "gw", "quasiparticle", "band-gap"]
container_enabled: true

parameters:
  # Band ranges
  bands_screening_min:
    type: "integer"
    default: 1
    description: "Lowest band for screening (BndsRnXp)"
    required: true

  bands_screening_max:
    type: "integer"
    default: 200
    description: "Highest band for screening (BndsRnXp)"
    required: true

  bands_self_energy_min:
    type: "integer"
    default: 1
    description: "Lowest band for self-energy (GbndRnge)"
    required: true

  bands_self_energy_max:
    type: "integer"
    default: 200
    description: "Highest band for self-energy (GbndRnge)"
    required: true

  # Cutoffs
  screening_cutoff:
    type: "float"
    default: 5.0
    min: 1.0
    max: 20.0
    description: "G-vectors cutoff for screening (Ry)"
    required: true

  exchange_cutoff:
    type: "float"
    default: 30.0
    min: 10.0
    max: 100.0
    description: "Exchange cutoff EXXRLvcs (Ry)"

  correlation_cutoff:
    type: "float"
    default: 30.0
    min: 10.0
    max: 100.0
    description: "Correlation cutoff VXCRLvcs (Ry)"

  # QP calculation range
  qp_kpoints_min:
    type: "integer"
    default: 1
    description: "First k-point for QP corrections"

  qp_kpoints_max:
    type: "integer"
    default: 10
    description: "Last k-point for QP corrections"

  qp_bands_min:
    type: "integer"
    default: 1
    description: "First band for QP corrections"

  qp_bands_max:
    type: "integer"
    default: 50
    description: "Last band for QP corrections"

  # Plasmon-pole model
  ppmodel:
    type: "select"
    options:
      - label: "Hybertsen-Louie (HL)"
        value: "HL"
      - label: "Godby-Needs (GN)"
        value: "GN"
      - label: "Farid-Engel (FE)"
        value: "FE"
    default: "HL"
    description: "Plasmon-pole approximation"

  # GW iterations
  gw_iterations:
    type: "integer"
    default: 0
    min: 0
    max: 10
    description: "Number of GW iterations (0 = one-shot G0W0)"

  # Job name
  job_name:
    type: "string"
    default: "gw"
    description: "Output job name for YAMBO"

files:
  yambo.in: yambo_input_template

yambo_input_template: |
  # GW Quasiparticle Calculation
  # Generated by Crystal-TUI

  gwcalc                     # Enable GW calculation
  GWoIter = {{ gw_iterations }}             # Number of GW iterations (0 = G0W0)

  # Screening calculation
  BndsRnXp= {{ bands_screening_min }} | {{ bands_screening_max }}    # Bands for polarization
  NGsBlkXp= {{ screening_cutoff }} Ry         # G-vectors for screening

  # Self-energy calculation
  GbndRnge= {{ bands_self_energy_min }} | {{ bands_self_energy_max }}    # Bands for self-energy

  # Plasmon-pole model
  ppmodel = "{{ ppmodel }}"         # {{ ppmodel }} plasmon pole

  # Exchange-correlation cutoffs
  EXXRLvcs= {{ exchange_cutoff }} Ry          # Exchange cutoff
  VXCRLvcs= {{ correlation_cutoff }} Ry          # Correlation cutoff

  # QP corrections k-points and bands
  %QPkrange
   {{ qp_kpoints_min }}| {{ qp_kpoints_max }}|  {{ qp_bands_min }}| {{ qp_bands_max }}
  %

execution:
  command: "yambo -F yambo.in -J {{ job_name }} -o g"
  container: "yambo_5.2.0_gpu.sif"
  gpu_required: false
  required_files:
    - "SAVE"
